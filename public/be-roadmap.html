<!--
Changelog (2025-11-27):
- Implemented Roadmap Versioning (V1: Backend, V2: Sophisticated Engineer)
- Added Version Switcher Dropdown
- Added support for Engineering Logic, Success Metrics, and Key Topics display
- Defaulted to V2 (C++ & DSA)
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Senior Developer Roadmap</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --warning: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        --danger: linear-gradient(135deg, #fa709a 0%, #fee140 100%);

        --bg-primary: #0f0f23;
        --bg-secondary: #1a1a35;
        --bg-card: #242450;
        --bg-surface: #2a2a5a;
        --bg-glass: rgba(255, 255, 255, 0.1);

        --text-primary: #ffffff;
        --text-secondary: #b8b8ff;
        --text-muted: #8a8ab8;

        --accent-blue: #64ffda;
        --accent-purple: #bb86fc;
        --accent-pink: #ff6b9d;
        --accent-green: #39ff9c;
        --accent-gold: #ffd700;

        --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        --shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.4);
        --glow: 0 0 20px rgba(100, 255, 218, 0.3);

        --border-radius: 16px;
        --border-radius-lg: 24px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        overflow-x: hidden;
      }

      /* Animated background */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(120, 119, 198, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 119, 198, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 80%,
            rgba(120, 255, 198, 0.1) 0%,
            transparent 50%
          );
        z-index: -1;
        animation: bgShift 20s ease-in-out infinite;
      }

      @keyframes bgShift {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      /* Hero Header */
      .hero-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 3rem 2rem;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border-radius: var(--border-radius-lg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .hero-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        animation: shimmer 3s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .hero-title {
        font-size: 3.5rem;
        font-weight: 800;
        background: linear-gradient(
          135deg,
          var(--accent-blue),
          var(--accent-purple),
          var(--accent-pink)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 1rem;
        animation: glow 2s ease-in-out infinite alternate;
      }

      @keyframes glow {
        from {
          filter: drop-shadow(0 0 10px rgba(100, 255, 218, 0.5));
        }
        to {
          filter: drop-shadow(0 0 20px rgba(187, 134, 252, 0.8));
        }
      }

      .hero-subtitle {
        font-size: 1.3rem;
        color: var(--text-secondary);
        font-weight: 400;
      }

      /* Version Switcher */
      .version-switcher-container {
          margin-bottom: 1.5rem;
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 1rem;
          position: relative;
          z-index: 10;
      }

      .version-select {
          appearance: none;
          background: var(--bg-surface);
          color: var(--text-primary);
          border: 1px solid var(--accent-blue);
          padding: 0.75rem 2.5rem 0.75rem 1.5rem;
          border-radius: 50px;
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2364ffda%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
          background-repeat: no-repeat;
          background-position: right 1rem center;
          background-size: 0.8rem auto;
      }

      .version-select:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px rgba(100, 255, 218, 0.3);
      }

      .version-select:focus {
          outline: none;
          border-color: var(--accent-purple);
          box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.3);
      }

      /* Level & XP System */
      .level-system {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
      }

      .level-card {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        padding: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .level-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-hover);
        border-color: var(--accent-blue);
      }

      .level-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary);
      }

      .stat-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--accent-blue);
        margin-bottom: 0.5rem;
        text-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
      }

      .stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
      }

      /* Role Fit rows */
      .role-row {
        font-weight: 600;
        margin-top: 0.25rem;
      }
      .role-hint {
        color: var(--text-muted);
        font-size: 0.85rem;
        margin-bottom: 0.5rem;
      }

      /* Progress Ring */
      .progress-ring {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 0 auto 1rem;
      }

      .progress-ring svg {
        transform: rotate(-90deg);
        width: 100%;
        height: 100%;
      }

      .progress-ring circle {
        fill: none;
        stroke-width: 8;
      }

      .progress-ring .bg {
        stroke: var(--bg-surface);
      }

      .progress-ring .progress {
        stroke: url(#gradient);
        stroke-linecap: round;
        transition: stroke-dasharray 0.5s ease, stroke-dashoffset 0.5s ease;
        stroke-dasharray: 0;
        stroke-dashoffset: 0;
      }

      /* Controls */
      .controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
        justify-content: center;
      }

      .btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: var(--border-radius);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        position: relative;
        overflow: hidden;
        min-width: 160px;
        justify-content: center;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
      }

      .btn-secondary {
        background: var(--bg-card);
        color: var(--text-primary);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn-secondary:hover {
        background: var(--bg-surface);
        border-color: var(--accent-blue);
        transform: translateY(-2px);
      }

      /* Charts Section */
      .charts-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .chart-card {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        padding: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .chart-card::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--success);
      }

      .chart-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--accent-blue);
      }

      .chart-wrapper {
        position: relative;
        height: 300px;
      }

      /* Roadmap Section */
      .roadmap-section {
        margin-bottom: 3rem;
      }

      .section-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 2rem;
        text-align: center;
        background: linear-gradient(
          135deg,
          var(--accent-blue),
          var(--accent-purple)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Phase Cards */
      .phase {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        margin-bottom: 2rem;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
      }

      .phase:hover {
        border-color: var(--accent-blue);
        box-shadow: var(--glow);
      }

      .phase-header {
        background: var(--primary);
        padding: 1.5rem 2rem;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .phase-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          45deg,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .phase-header:hover::before {
        opacity: 1;
      }

      .phase-header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
        z-index: 1;
      }

      .phase-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .phase-icon {
        font-size: 2rem;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }

      .phase-progress {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        backdrop-filter: blur(10px);
      }

      .phase-content {
        padding: 2rem;
        transition: all 0.3s ease;
      }

      .phase.collapsed .phase-content {
        display: none;
      }

      /* Topic Cards */
      .topic {
        background: var(--bg-primary);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        margin-bottom: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .topic::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--secondary);
        transition: width 0.3s ease;
      }

      .topic:hover {
        border-color: var(--accent-blue);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }

      .topic:hover::before {
        width: 8px;
      }

      .topic.completed {
        border-color: var(--accent-green);
        background: linear-gradient(
          135deg,
          rgba(57, 255, 156, 0.1),
          rgba(100, 255, 218, 0.1)
        );
      }

      .topic.completed::before {
        background: var(--warning);
      }

      .topic-header {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .checkbox-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex: 1;
      }

      .checkbox {
        width: 20px;
        height: 20px;
        accent-color: var(--accent-blue);
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .checkbox:checked {
        filter: drop-shadow(0 0 5px var(--accent-blue));
      }

      .topic-title {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 1.1rem;
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .topic-title:hover {
        color: var(--accent-blue);
      }

      .priority-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }

      .priority-high {
        background: var(--danger);
        color: white;
        box-shadow: 0 0 15px rgba(250, 112, 154, 0.4);
      }

      .priority-medium {
        background: var(--warning);
        color: var(--bg-primary);
        box-shadow: 0 0 15px rgba(67, 233, 123, 0.4);
      }

      .priority-low {
        background: var(--success);
        color: var(--bg-primary);
        box-shadow: 0 0 15px rgba(79, 172, 254, 0.4);
      }

      /* Pacing & Section Badges */
      .pacing-badge {
        padding: 0.25rem 0.6rem;
        border-radius: 16px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-left: 0.5rem;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
      }

      .pacing-accelerate {
        background: var(--success);
        color: var(--bg-primary);
      }

      .pacing-needstime {
        background: var(--warning);
        color: var(--bg-primary);
      }

      .prereq-badge {
        background: linear-gradient(
          135deg,
          rgba(100, 255, 218, 0.25),
          rgba(187, 134, 252, 0.25)
        );
        color: var(--accent-blue);
        border: 1px solid rgba(100, 255, 218, 0.35);
      }

      .topic-description {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        line-height: 1.6;
      }

      .objective-description {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 4px solid var(--accent-blue);
        font-style: italic;
      }

      .focus-areas {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: rgba(100, 255, 218, 0.1);
        border-radius: 8px;
        border-left: 3px solid var(--accent-blue);
      }

      /* Engineering Logic & Success Metrics */
      .engineering-logic {
        background: rgba(187, 134, 252, 0.1);
        border-left: 3px solid var(--accent-purple);
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 0 8px 8px 0;
        position: relative;
      }
      
      .engineering-logic-title {
        color: var(--accent-purple);
        font-weight: 700;
        margin-bottom: 0.5rem;
        display: block;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .success-metric {
        background: rgba(79, 172, 254, 0.1);
        border-left: 3px solid var(--success);
        padding: 0.75rem;
        margin-top: 0.75rem;
        border-radius: 4px;
        font-size: 0.9rem;
        color: var(--text-primary);
      }

      /* Time Tracker */
      .time-tracker {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 1rem;
        background: var(--bg-glass);
        border-radius: var(--border-radius);
        backdrop-filter: blur(10px);
      }

      .time-item {
        text-align: center;
      }

      .time-label {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 0.25rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .time-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--accent-blue);
      }

      .time-input {
        width: 80px;
        padding: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        background: var(--bg-surface);
        color: var(--text-primary);
        text-align: center;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }

      .time-input:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
      }

      /* Notes */
      .notes-container {
        margin-top: 1rem;
      }

      .notes-input {
        width: 100%;
        padding: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--border-radius);
        background: var(--bg-surface);
        color: var(--text-primary);
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
        transition: all 0.3s ease;
      }

      .notes-input:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 15px rgba(100, 255, 218, 0.2);
      }

      /* Resources */
      .resources {
        margin-top: 1rem;
      }

      .resources-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--accent-purple);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .resource-links {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .resource-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: linear-gradient(
          135deg,
          rgba(187, 134, 252, 0.2),
          rgba(100, 255, 218, 0.2)
        );
        border-radius: 20px;
        text-decoration: none;
        color: var(--text-primary);
        font-size: 0.85rem;
        font-weight: 500;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .resource-link:hover {
        background: linear-gradient(
          135deg,
          rgba(187, 134, 252, 0.4),
          rgba(100, 255, 218, 0.4)
        );
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(187, 134, 252, 0.3);
      }

      .resource-link::before {
        content: "üîó";
        font-size: 0.8rem;
      }

      /* Resource Progress */
      .resource-row {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0.25rem 0;
        flex-wrap: wrap;
      }
      .resource-slider {
        width: 140px;
        accent-color: var(--accent-blue);
      }
      .resource-progress {
        min-width: 36px;
        text-align: right;
        color: var(--accent-blue);
        font-weight: 600;
      }

      /* Advanced Topics */
      .advanced-section {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        padding: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
        margin-bottom: 2rem;
      }

      .advanced-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--danger);
      }

      .advanced-topic {
        background: var(--bg-surface);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        margin-bottom: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .advanced-topic-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--accent-pink);
        margin-bottom: 0.5rem;
      }

      .advanced-topic-desc {
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
      }
      
      .advanced-topic-importance {
        color: var(--text-muted);
        font-size: 0.9rem;
        font-style: italic;
      }

      /* Modals */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      }

      .modal.show {
        display: flex;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      .modal-content {
        background: var(--bg-card);
        border-radius: var(--border-radius);
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        animation: slideUp 0.3s ease;
      }

      @keyframes slideUp {
        from { opacity: 0; transform: translateY(50px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--accent-blue);
      }

      .modal-text {
        margin-bottom: 1.5rem;
        color: var(--text-secondary);
      }

      .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      .file-input {
        width: 100%;
        padding: 1rem;
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: var(--border-radius);
        background: var(--bg-surface);
        color: var(--text-primary);
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .file-input:hover {
        border-color: var(--accent-blue);
        background: var(--bg-glass);
      }
      
      /* Visibility helpers */
      .hidden {
          display: none !important;
      }

      /* Responsive Design */
      @media (max-width: 1024px) {
        .charts-grid {
          grid-template-columns: 1fr;
        }
        .hero-title {
          font-size: 2.5rem;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }
        .hero-title {
          font-size: 2rem;
        }
        .hero-subtitle {
          font-size: 1.1rem;
        }
        .time-tracker {
          grid-template-columns: 1fr;
          gap: 0.5rem;
        }
        .controls {
          flex-direction: column;
          align-items: stretch;
        }
        .chart-wrapper {
          height: 250px;
        }
        .phase-header {
          padding: 1rem;
        }
      }

      .expand-icon {
        transition: transform 0.3s ease;
        font-size: 1.2rem;
        color: var(--accent-blue);
      }

      .collapsed .expand-icon {
        transform: rotate(-90deg);
      }

      /* Achievement Styles */
      .achievement {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--success);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--border-radius);
        font-weight: 600;
        z-index: 1001;
        transform: translateX(400px);
        transition: transform 0.5s ease;
        box-shadow: var(--shadow);
      }

      .achievement.show {
        transform: translateX(0);
      }

      .achievement::before {
        content: "üéâ";
        margin-right: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Hero Header -->
      <div class="hero-header">
        <div class="version-switcher-container">
            <select id="versionSelect" class="version-select" onchange="switchVersion(this.value)">
                <option value="v3" selected>Version 3: DSA Mastery (4-Month)</option>
                <option value="v2">Version 2: Sophisticated Engineer (Legacy)</option>
                <option value="v1">Version 1: Backend Roadmap (Legacy)</option>
            </select>
        </div>
        <h1 class="hero-title" id="heroTitle">Senior Developer Roadmap</h1>
        <p class="hero-subtitle" id="heroSubtitle">
          Master the skills to become a top-tier engineer
        </p>
      </div>

      <!-- Level System -->
      <div class="level-system">
        <div class="level-card">
          <div class="progress-ring">
            <svg>
              <defs>
                <linearGradient
                  id="gradient"
                  x1="0%"
                  y1="0%"
                  x2="100%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #64ffda; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #bb86fc; stop-opacity: 1"
                  />
                </linearGradient>
              </defs>
              <circle class="bg" cx="60" cy="60" r="50"></circle>
              <circle
                class="progress"
                cx="60"
                cy="60"
                r="50"
                id="progressCircle"
              ></circle>
            </svg>
            <div
              style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
              "
            >
              <div class="stat-value" id="overallProgress">0%</div>
            </div>
          </div>
          <div class="stat-label">Quest Progress</div>
        </div>

        <div class="level-card">
          <span class="stat-icon">‚ö°</span>
          <div class="stat-value" id="completedTasks">0</div>
          <div class="stat-label">Resources Completed</div>
        </div>

        <div class="level-card">
          <span class="stat-icon">‚è±Ô∏è</span>
          <div class="stat-value" id="totalSessions">0</div>
          <div class="stat-label">Sessions Completed</div>
        </div>

        <div class="level-card">
          <span class="stat-icon">üéØ</span>
          <div class="stat-value" id="plannedSessions">0</div>
          <div class="stat-label">Planned Sessions</div>
        </div>
        
        <!-- Problems Solved (V3 Only) -->
        <div class="level-card v3-only">
          <span class="stat-icon">üß©</span>
          <div style="display:flex;align-items:baseline;justify-content:center;gap:0.25rem;">
            <input type="number" id="problemsSolvedInput" class="time-input" style="width:60px;font-size:1.5rem;font-weight:700;color:var(--accent-blue);" value="0" min="0" onchange="updateProblemsSolved(this.value)">
            <span class="stat-value" style="font-size:1rem;color:var(--text-muted);">/ 200</span>
          </div>
          <div class="stat-label">Problems Solved</div>
        </div>
        
        <!-- Backend Readiness (V1 Only) -->
        <div class="level-card v1-only">
          <div class="progress-ring">
            <svg>
              <defs>
                <linearGradient
                  id="gradientReadiness"
                  x1="0%"
                  y1="0%"
                  x2="100%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #ffd700; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #64ffda; stop-opacity: 1"
                  />
                </linearGradient>
              </defs>
              <circle class="bg" cx="60" cy="60" r="50"></circle>
              <circle
                class="progress"
                cx="60"
                cy="60"
                r="50"
                id="readinessCircle"
                style="stroke: url(#gradientReadiness)"
              ></circle>
            </svg>
            <div
              style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
              "
            >
              <div class="stat-value" id="readinessValue">0%</div>
            </div>
          </div>
          <div class="stat-label">Backend Readiness</div>
        </div>
        
        <!-- Role Fit (V1 Only) -->
        <div class="level-card v1-only">
          <span class="stat-icon">üëî</span>
          <div class="stat-label">Role Fit</div>
          <div class="role-row" id="rf-fe-heavy">
            Full‚Äëstack (FE‚Äëheavy): <span id="rf-fe-heavy-score">0%</span>
          </div>
          <div class="role-hint">
            Front‚Äëend senior + back‚Äëend basics; hiring focus on FE.
          </div>
          <div class="role-row" id="rf-backend-mid">
            Backend (Mid‚Äëlevel): <span id="rf-backend-mid-score">0%</span>
          </div>
          <div class="role-hint">
            Independent backend delivery on core APIs and systems.
          </div>
          <div class="role-row" id="rf-fs-balanced">
            Full‚Äëstack (Balanced): <span id="rf-fs-balanced-score">0%</span>
          </div>
          <div class="role-hint">
            Senior in both FE and BE; leading across the stack.
          </div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="btn btn-primary" onclick="exportProgress()">
          üíæ Export Progress
        </button>
        <button class="btn btn-secondary" onclick="importProgress()">
          üì• Import Progress
        </button>
        <button class="btn btn-secondary" onclick="resetProgress()">
          üîÑ Reset Quest
        </button>
      </div>

      <!-- Charts -->
      <div class="charts-grid">
        <div class="chart-card v1-only">
          <div class="chart-title">üåü Gate Passes per Project</div>
          <div class="chart-wrapper">
            <canvas id="phaseChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">
            ‚è∞ Planned vs Completed Sessions
          </div>
          <div class="chart-wrapper">
            <canvas id="timeChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Competency Gates (V1 Only) -->
      <div class="phase v1-only" id="gates">
        <div class="phase-header" onclick="togglePhase('gates')">
          <div class="phase-header-content">
            <div class="phase-title">
              <span class="phase-icon">‚úÖ</span>
              <span class="expand-icon">‚ñº</span>
              Competency Gates (Artifact‚Äëdriven Readiness)
            </div>
            <div class="phase-progress" id="progress-gates">
              Actionable Pass/Fail chips
            </div>
          </div>
        </div>
        <div class="phase-content" id="content-gates">
          <div id="gatesContent"></div>
        </div>
      </div>

      <!-- Roadmap -->
      <div class="roadmap-section" id="main-roadmap">
        <h2 class="section-title" id="roadmap-track-title">üó∫Ô∏è Core Track</h2>
        <div id="roadmapContent"></div>
      </div>

      <!-- Advanced Topics -->
      <div class="advanced-section" id="advanced-section">
        <h2 class="section-title">üöÄ Advanced / Future Track</h2>
        <div id="advancedTopics"></div>
      </div>

      <!-- Express vs NestJS Guidance (V1 Only) -->
      <div class="phase v1-only" id="express-vs-nest">
        <div class="phase-header" onclick="togglePhase('express-vs-nest')">
          <div class="phase-header-content">
            <div class="phase-title">
              <span class="phase-icon">üß≠</span>
              <span class="expand-icon">‚ñº</span>
              Express vs NestJS: Hiring Signal Guidance
            </div>
            <div class="phase-progress">
              Express for speed; optional NestJS after interviews
            </div>
          </div>
        </div>
        <div class="phase-content" id="content-express-vs-nest">
          <div id="expressNestContent"></div>
        </div>
      </div>

      <!-- Resources Grid -->
      <div class="phase" id="resources">
        <div class="phase-header" onclick="togglePhase('resources')">
          <div class="phase-header-content">
            <div class="phase-title">
              <span class="phase-icon">üìö</span>
              <span class="expand-icon">‚ñº</span>
              Curated Resources
            </div>
            <div class="phase-progress">
              Targeted study with hours and priorities
            </div>
          </div>
        </div>
        <div class="phase-content" id="content-resources">
          <div id="resourcesGrid"></div>
        </div>
      </div>
    </div>

    <!-- Job Requirement Coverage (V1 Only) -->
    <div class="phase v1-only" id="job-coverage">
      <div class="phase-header" onclick="togglePhase('job-coverage')">
        <div class="phase-header-content">
          <div class="phase-title">
            <span class="phase-icon">üìä</span>
            <span class="expand-icon">‚ñº</span>
            Job Requirement Coverage
          </div>
          <div class="phase-progress">Interactive checklists with links</div>
        </div>
      </div>
      <div class="phase-content" id="content-job-coverage">
        <div id="jobCoverage"></div>
      </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal">
      <div class="modal-content">
        <h3 class="modal-title">üì• Import Progress</h3>
        <p class="modal-text">
          You already have existing progress. How would you like to handle the
          import?
        </p>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="handleImport('merge')">
            üîÑ Merge
          </button>
          <button class="btn btn-primary" onclick="handleImport('overwrite')">
            ‚ôªÔ∏è Overwrite
          </button>
          <button class="btn btn-secondary" onclick="closeModal()">
            ‚ùå Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- File Import Modal -->
    <div id="fileModal" class="modal">
      <div class="modal-content">
        <h3 class="modal-title">üìÇ Import Progress File</h3>
        <input
          type="file"
          id="fileInput"
          class="file-input"
          accept=".json"
          placeholder="Choose your progress file..."
        />
        <div class="modal-actions">
          <button class="btn btn-primary" onclick="processFileImport()">
            üì• Import
          </button>
          <button class="btn btn-secondary" onclick="closeModal()">
            ‚ùå Cancel
          </button>
        </div>
      </div>
    </div>

    <script>
      // ==========================================
      // DATA: Version 2 - Sophisticated Engineer
      // ==========================================
      const roadmapDataV2 = {
        learningObjectives: [
            {
                id: "sophisticated-engineer",
                title: "Sophisticated Engineer Track (C++ & DSA)",
                icon: "üß†",
                description: "A 6-month journey to master Data Structures, Algorithms, and System Design using C++. Focus on memory, efficiency, and patterns.",
                estimatedTime: 240, 
                topics: [
                    {
                        id: "phase-1-foundations",
                        title: "Phase 1: The Foundation (Weeks 1-4) ‚Äì C++ Memory Mastery",
                        description: "Move beyond syntax. Understand how the machine actually works.",
                        engineeringLogic: "You cannot optimize high-performance systems if you don't understand the cost of a pointer dereference or a memory allocation. We use C++ here to force manual memory management, creating an intuition that transfers to every other language.",
                        successMetric: "Able to implement a recursive solution without blowing the stack and explain int* vs int&.",
                        keyTopics: [
                            "Pointers vs. References (Stack vs. Heap)",
                            "Memory Management (New/Delete)",
                            "Recursive Functions (Prerequisite for Trees)",
                            "STL: Vectors, Strings, Maps (Usage)"
                        ],
                        priority: "high",
                        estimatedTime: 40,
                        plannedSessions: 20,
                        resources: [
                            {
                                 name: "Mastering 4 critical SKILLS using C++ 17",
                                 url: "https://www.udemy.com/course/cpp-4skills/",
                                 hours: 40
                            }
                        ],
                        notes: "Skip the final 'Library Project.' Focus on the raw language mechanics."
                    },
                    {
                        id: "phase-2-linear",
                        title: "Phase 2: Building the Tools (Linear) (Weeks 5-9)",
                        description: "Stop using arrays; start building them.",
                        engineeringLogic: "We build these from scratch to understand the 'hidden costs.' Why is unshift() in JS slow? Because in a Vector, it forces a O(n) shift of all elements. Building it proves it.",
                        successMetric: "You have a custom MyVector class that resizes itself automatically.",
                        keyTopics: [
                            "Time Complexity Analysis: Big O notation",
                            "Dynamic Arrays: Implementing a Vector class from scratch (Capacity vs Size)",
                            "Linked Lists: Single & Doubly Linked Lists",
                            "Stacks & Queues: Building them using your own Linked List"
                        ],
                        priority: "high",
                        estimatedTime: 50,
                        plannedSessions: 25,
                         resources: [
                            {
                                 name: "Mastering critical SKILLS in Data Structures using C++",
                                 url: "https://www.udemy.com/course/dscpp-skills/",
                                 hours: 50
                            }
                        ]
                    },
                    {
                        id: "phase-3-nonlinear",
                        title: "Phase 3: The Architect's Mind (Non-Linear) (Weeks 10-14)",
                        description: "Handling hierarchical data and fast lookups.",
                        engineeringLogic: "The Hash Map is the most used data structure in the world. By building one, you understand 'Collisions' and 'Load Factors,' which is essential for understanding Database Indexing later.",
                        successMetric: "A working MyHashMap class.",
                        keyTopics: [
                             "Hash Tables: Implementing a Hash Map with Chaining (Handling collisions)",
                             "Binary Trees: Traversals (In-order, Pre-order)",
                             "Binary Search Trees (BST): O(log n) lookup logic"
                        ],
                        priority: "high",
                        estimatedTime: 50,
                        plannedSessions: 25,
                        resources: [
                            {
                                 name: "Mastering critical SKILLS in Data Structures using C++ (Continued)",
                                 url: "https://www.udemy.com/course/dscpp-skills/",
                                 hours: 50
                            }
                        ]
                    },
                    {
                        id: "phase-4-algorithms",
                        title: "Phase 4: Core Algorithms (Weeks 15-18)",
                        description: "Sorting and Searching with mathematical precision.",
                        engineeringLogic: "Sorting isn't just Array.sort(). It's about memory locality and worst-case scenarios. Merge Sort is stable; Quick Sort is fast. Knowing when to use which is the Senior Engineer trait.",
                        successMetric: "Can write Merge Sort on a whiteboard without syntax errors.",
                        keyTopics: [
                             "Sorting: Merge Sort (Divide & Conquer) & Quick Sort",
                             "Binary Search: Mastering the logic (Standard & Lower/Upper bound)",
                             "Recursion (Advanced): Tracing complex recursion trees"
                        ],
                        priority: "high",
                        estimatedTime: 40,
                        plannedSessions: 20,
                        resources: [
                            {
                                 name: "Algorithms Part 1",
                                 url: "https://www.udemy.com/course/skills-algorithms-cpp/",
                                 hours: 40
                            }
                        ]
                    },
                    {
                        id: "phase-5-graphs-dp",
                        title: "Phase 5: Advanced Graphs & DP (Weeks 19-22)",
                        description: "Modeling complex relationships and optimization problems.",
                        engineeringLogic: "Real-world problems (Social Networks, Google Maps, Package Dependencies) are Graphs. You cannot solve them with Arrays. DP teaches you to trade Space (Memory) for Time (Speed).",
                        successMetric: "Solving 'Number of Islands' and 'Climbing Stairs' (Memoized).",
                        keyTopics: [
                             "Graph Traversal: BFS (Breadth-First) & DFS (Depth-First)",
                             "Topological Sort: Dependency resolution",
                             "Dynamic Programming: Memoization (Caching results)"
                        ],
                        priority: "high",
                        estimatedTime: 40,
                        plannedSessions: 20,
                        resources: [
                            {
                                 name: "Algorithms Part 2",
                                 url: "https://www.udemy.com/course/skills-algorithms-cpp2/",
                                 hours: 40
                            }
                        ]
                    },
                    {
                        id: "phase-6-interview",
                        title: "Phase 6: The Interview Bridge (Weeks 23-24)",
                        description: "Translating academic theory into interview performance.",
                        engineeringLogic: "Academic courses teach 'First Principles.' Interviews test 'Pattern Matching.' This phase bridges that gap.",
                        successMetric: "Confidence with Medium-level LeetCode/NeetCode problems.",
                        keyTopics: [
                            "Sliding Window: Optimization for subarrays",
                            "Two Pointers: Space optimization",
                            "Review: NeetCode 150 (Mediums)"
                        ],
                        priority: "high",
                        estimatedTime: 20,
                        plannedSessions: 10,
                        resources: [
                            {
                                name: "NeetCode 150 Practice",
                                url: "https://neetcode.io/practice",
                                hours: 20
                            }
                        ]
                    },
                    {
                        id: "parallel-system-design",
                        title: "Parallel Track: System Design (Weekends Only)",
                        description: "Preparing for the L5/L6 Senior Round.",
                        engineeringLogic: "While your left brain learns Algorithms, your right brain absorbs Architecture (Load Balancers, Caching, Sharding) to prevent being 'down-leveled' during interviews.",
                        successMetric: "Understand standard distributed system patterns.",
                        keyTopics: [
                            "Read 1 Chapter every weekend. No coding."
                        ],
                        priority: "medium",
                        estimatedTime: 24,
                        plannedSessions: 24,
                        resources: [
                             {
                                name: "System Design Interview ‚Äì An Insider's Guide (Alex Xu)",
                                url: "https://bytebytego.com/",
                                hours: 24
                             }
                        ]
                    }
                ]
            }
        ],
        projects: [], 
        curatedResources: [],
        advancedTopics: [] 
      };

      // ==========================================
      // DATA: Version 3 - DSA Mastery (4-Month)
      // ==========================================
      const roadmapDataV3 = {
        learningObjectives: [
            {
                id: "dsa-mastery-4month",
                title: "DSA Mastery Track (4-Month)",
                icon: "üéØ",
                description: "From Frontend Developer to Sophisticated Software Engineer. Master Data Structures & Algorithms with C++ in 4 months. Focus: 40% learning, 60% practicing. Target: 150-200 problems solved.",
                estimatedTime: 200,
                topics: [
                    {
                        id: "phase-0-cpp-refresher",
                        title: "Phase 0: C++ Refresher (Week 1-2)",
                        description: "Get comfortable with C++ syntax and STL before diving into DSA. You have prior C++ experience from Programming I, so this is a refresher, not a beginner course.",
                        engineeringLogic: "JavaScript hides too much (no pointers, automatic memory, no native data structures like linked lists). C++ teaches you CS fundamentals while being practical. You can always use JavaScript for web dev work.",
                        successMetric: "Can read/write C++ code, use vector, map, set, stack, queue, priority_queue comfortably. Solved 10-15 basic problems.",
                        keyTopics: [
                            "Variables, data types, operators",
                            "Control flow (if/else, loops, switch)",
                            "Functions, pointers, references",
                            "Dynamic memory (new, delete)",
                            "STL: vector, string, map, unordered_map, set, stack, queue, priority_queue, pair"
                        ],
                        priority: "high",
                        pacing: "accelerate",
                        estimatedTime: 12,
                        plannedSessions: 8,
                        resources: [
                            { name: "C++ Tutorial for Beginners - Full Course (freeCodeCamp)", url: "https://www.youtube.com/watch?v=vLnPwxZdW4Y", hours: 4 },
                            { name: "LearnCpp.com (Sections 1-13)", url: "https://www.learncpp.com/", hours: 6 },
                            { name: "HackerRank C++ Track", url: "https://www.hackerrank.com/domains/cpp", hours: 3 }
                        ],
                        notes: "Watch at 1.5x speed, skip what you remember. Focus on pointers, references, and STL containers."
                    },
                    {
                        id: "month-1-foundations",
                        title: "Month 1: Foundations (Weeks 3-6)",
                        description: "Build the foundation: Big O notation, Arrays, Strings, and Recursion. These are the building blocks for everything else.",
                        engineeringLogic: "Understanding time/space complexity is the lens through which you evaluate every solution. Arrays and strings are everywhere. Recursion is the prerequisite for trees and graphs.",
                        successMetric: "Solve most Easy array/string problems in 15-20 minutes. Can explain Big O for common operations. Understand when to use recursion.",
                        keyTopics: [
                            "Big O Notation: Time & Space complexity, Best/Average/Worst case",
                            "Arrays: Static vs dynamic, Two-pointer technique, Sliding window pattern",
                            "Strings: Manipulation, Pattern matching basics",
                            "Recursion: Base case, recursive case, call stack understanding"
                        ],
                        priority: "high",
                        pacing: "needstime",
                        estimatedTime: 45,
                        plannedSessions: 20,
                        resources: [
                            { name: "Abdul Bari: Introduction & Recursion (Sections 1-5)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 15 },
                            { name: "Abdul Bari: Arrays (Section 6)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 5 },
                            { name: "NeetCode: Arrays & Hashing (Easy)", url: "https://neetcode.io/roadmap", hours: 8 },
                            { name: "NeetCode: Two Pointers (Easy)", url: "https://neetcode.io/roadmap", hours: 6 },
                            { name: "NeetCode: Sliding Window (Easy)", url: "https://neetcode.io/roadmap", hours: 5 }
                        ],
                        notes: "Target: 20-25 problems this month. Watch Abdul Bari at 1.25-1.5x speed. Skip advanced proofs."
                    },
                    {
                        id: "month-2-linear",
                        title: "Month 2: Linear Data Structures (Weeks 7-10)",
                        description: "Master the fundamental linear data structures: Linked Lists, Stacks, Queues, and Hash Tables. Implement each from scratch at least once.",
                        engineeringLogic: "We build these from scratch to understand the 'hidden costs.' Why is unshift() in JS slow? Because in an array, it forces O(n) shift of all elements. Building these structures proves the theory.",
                        successMetric: "Implemented linked list from scratch. Understand when to use each structure. Recognize stack/queue patterns. Master hash table usage. 50-70 total problems solved.",
                        keyTopics: [
                            "Linked Lists: Singly & Doubly, Fast/Slow pointer, Reversal",
                            "Stacks: LIFO, Parentheses matching, Expression evaluation",
                            "Queues: FIFO, Circular queue, Deque",
                            "Hashing: Hash functions, Collision handling, unordered_map vs map"
                        ],
                        priority: "high",
                        estimatedTime: 45,
                        plannedSessions: 20,
                        resources: [
                            { name: "Abdul Bari: Linked Lists (Section 11)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 8 },
                            { name: "Abdul Bari: Stacks (Section 13)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 4 },
                            { name: "Abdul Bari: Queues (Section 14)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 4 },
                            { name: "Abdul Bari: Hashing (Section 12)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 5 },
                            { name: "NeetCode: Linked List (Easy ‚Üí Medium)", url: "https://neetcode.io/roadmap", hours: 10 },
                            { name: "NeetCode: Stack (Easy ‚Üí Medium)", url: "https://neetcode.io/roadmap", hours: 8 }
                        ],
                        notes: "Target: 25-30 problems this month. Implement each data structure from scratch before using STL."
                    },
                    {
                        id: "month-3-trees-graphs",
                        title: "Month 3: Trees & Graphs (Weeks 11-14)",
                        description: "Handle hierarchical data and graph traversals. This is where many developers struggle, but mastering these opens doors to solving complex problems.",
                        engineeringLogic: "Trees model hierarchical relationships (DOM, file systems, org charts). Graphs model networks (social, maps, dependencies). BFS/DFS are the foundation for countless algorithms.",
                        successMetric: "Implemented BST from scratch. Can traverse trees in all 4 ways. Understand heap operations. Comfortable with BFS and DFS. 100-120 total problems solved.",
                        keyTopics: [
                            "Binary Trees: Terminology, Traversals (inorder, preorder, postorder, level-order)",
                            "Binary Search Trees: BST property, Insert/Delete/Search operations",
                            "Heaps: Min/Max heap, Insert/Extract/Heapify, priority_queue usage",
                            "Graphs: Adjacency matrix/list, BFS, DFS, Directed vs Undirected"
                        ],
                        priority: "high",
                        pacing: "needstime",
                        estimatedTime: 50,
                        plannedSessions: 22,
                        resources: [
                            { name: "Abdul Bari: Trees (Section 15)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 12 },
                            { name: "Abdul Bari: Heaps (Section 17)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 5 },
                            { name: "Abdul Bari: Graphs (Section 16)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 8 },
                            { name: "NeetCode: Trees (Easy ‚Üí Medium)", url: "https://neetcode.io/roadmap", hours: 12 },
                            { name: "NeetCode: Heap / Priority Queue", url: "https://neetcode.io/roadmap", hours: 5 },
                            { name: "NeetCode: Graphs (BFS/DFS)", url: "https://neetcode.io/roadmap", hours: 8 }
                        ],
                        notes: "Target: 25-30 problems. Skip AVL Trees for now (can return later). Focus on traversals and BFS/DFS patterns."
                    },
                    {
                        id: "month-4-algorithms",
                        title: "Month 4: Algorithms (Weeks 15-18)",
                        description: "Master the classic algorithms: Sorting, Divide & Conquer, Dynamic Programming, Greedy, and Backtracking. DP is the hardest topic - be patient!",
                        engineeringLogic: "Sorting isn't just Array.sort(). It's about memory locality and worst-case scenarios. DP teaches you to trade space for time. Greedy vs DP decision-making is a Senior Engineer trait.",
                        successMetric: "Understand major sorting algorithms. Can solve basic 1D DP problems. Recognize greedy vs DP situations. Comfortable with backtracking pattern. 150-180 total problems solved.",
                        keyTopics: [
                            "Sorting: Merge Sort, Quick Sort, Heap Sort, when to use which",
                            "Divide & Conquer: Problem-solving pattern, Recurrence relations",
                            "Dynamic Programming: Overlapping subproblems, Memoization vs Tabulation, 1D then 2D",
                            "Greedy: Greedy choice property, When it works vs doesn't",
                            "Backtracking: Recursive exploration, Pruning, Permutations/Combinations/Subsets"
                        ],
                        priority: "high",
                        pacing: "needstime",
                        estimatedTime: 55,
                        plannedSessions: 24,
                        resources: [
                            { name: "Abdul Bari: Sorting (Sections 7-8)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 8 },
                            { name: "Abdul Bari: Divide & Conquer (Section 9)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 5 },
                            { name: "Abdul Bari: Dynamic Programming (Section 19)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 12 },
                            { name: "Abdul Bari: Greedy (Section 18)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 5 },
                            { name: "Abdul Bari: Backtracking (Section 20)", url: "https://www.udemy.com/course/datastructurescncpp/", hours: 5 },
                            { name: "NeetCode: 1-D Dynamic Programming", url: "https://neetcode.io/roadmap", hours: 10 },
                            { name: "NeetCode: Greedy", url: "https://neetcode.io/roadmap", hours: 5 },
                            { name: "NeetCode: Backtracking", url: "https://neetcode.io/roadmap", hours: 5 }
                        ],
                        notes: "Target: 30-35 problems. Spend extra time on DP - it's the hardest but most valuable topic. Start with 1D DP before 2D."
                    },
                    {
                        id: "parallel-system-design",
                        title: "Parallel Track: System Design (Weekends Only)",
                        description: "Preparing for the L5/L6 Senior Round. Read 1 chapter every weekend - no coding required.",
                        engineeringLogic: "While your left brain learns Algorithms, your right brain absorbs Architecture (Load Balancers, Caching, Sharding) to prevent being 'down-leveled' during interviews.",
                        successMetric: "Understand standard distributed system patterns. Can discuss trade-offs in system design interviews.",
                        keyTopics: [
                            "Read 1 Chapter every weekend - No coding",
                            "Load Balancing, Caching, CDNs",
                            "Database Scaling, Sharding, Replication",
                            "Message Queues, Microservices patterns"
                        ],
                        priority: "medium",
                        estimatedTime: 24,
                        plannedSessions: 16,
                        resources: [
                            { name: "System Design Interview ‚Äì An Insider's Guide (Alex Xu)", url: "https://bytebytego.com/", hours: 24 }
                        ],
                        notes: "This runs in parallel with the main DSA track. Weekend reading only - don't let it distract from weekday problem solving."
                    }
                ]
            }
        ],
        projects: [],
        curatedResources: [],
        advancedTopics: []
      };

      // ==========================================
      // DATA: Version 1 - Backend Roadmap (Legacy)
      // ==========================================
      const roadmapDataV1 = {
        learningObjectives: [
          {
            id: "core-12-week",
            title: "Core 12‚ÄëWeek Track",
            icon: "üó∫Ô∏è",
            description:
              "Practical, artifact‚Äëgated plan aligned with EU remote roles. Ship two production‚Äëgrade backends by Weeks 8‚Äì10. Readiness is defined by Competency Gates (Testing, API Docs, Security, Reliability, Ops, Design).",
            estimatedTime: 120,
            topics: [
              {
                id: "w0-foundations",
                title: "Foundations & Prerequisites (Mark as Complete)",
                description:
                  "<div><strong>What</strong>: Baseline familiarity with Node, Express, and SQL to ensure Week 1 speed. Mark items done when you finish.<br/><strong>Note</strong>: <em>Currently studying</em> ‚Äî complete advanced SQL modules (EXPLAIN ANALYZE, indexing, transactions) by Week 1.</div>",
                priority: "high",
                isPrerequisites: true,
                pacing: "needstime",
                estimatedTime: 6,
                plannedSessions: 4,
                resources: [
                  {
                    name: "Node.js Crash Course (Traversy Media)",
                    url: "https://www.youtube.com/watch?v=fBNz5xF-Kx4",
                    hours: 1.5,
                  },
                  {
                    name: "Express.js Crash Course (Traversy Media)",
                    url: "https://www.youtube.com/watch?v=L72fhGm1tfE",
                    hours: 1.0,
                  },
                  {
                    name: "The Complete SQL Bootcamp (Udemy, PostgreSQL)",
                    url: "https://www.udemy.com/course/the-complete-sql-bootcamp",
                    hours: 9.0,
                  },
                ],
              },
              {
                id: "w1-express-prisma-docker",
                title:
                  "Week 1: Advanced PostgreSQL + Node.js Event Loop + SQL Mastery",
                description:
                  "<div><strong>Learning objectives</strong>: Event loop phases, indexing strategies (B‚Äëtree, GIN, GiST, Hash, BRIN), window functions, CTEs, EXPLAIN ANALYZE workflow.<br/><strong>Deliverables</strong>: CRUD with pagination, migrations + seed, standardized error shape (RFC7807), structured logs, <em>Indexing strategy document</em>.<br/><strong>Hours</strong>: 12‚Äì14 theory + 10‚Äì12 hands‚Äëon. <strong>Pacing</strong>: Foundational ‚Äî take 20‚Äì24 hrs.</div>",
                priority: "high",
                pacing: "needstime",
                estimatedTime: 22,
                plannedSessions: 8,
                resources: [
                  {
                    name: "Node.js Event Loop Explained",
                    url: "https://www.youtube.com/watch?v=8aGhZQkoFbQ",
                    hours: 0.17,
                  },
                  {
                    name: "Node.js Official: Event Loop",
                    url: "https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/",
                    hours: 0.5,
                  },
                  {
                    name: "PostgreSQL Indexing Deep Dive",
                    url: "https://www.meerako.com/blogs/postgresql-indexing-strategies-btree-gin-gist-guide",
                    hours: 2.0,
                  },
                  {
                    name: "SQL Window Functions",
                    url: "https://mode.com/sql-tutorial/sql-window-functions/",
                    hours: 1.0,
                  },
                  {
                    name: "PostgreSQL Performance Tips",
                    url: "https://www.postgresql.org/docs/current/performance-tips.html",
                    hours: 1.0,
                  },
                ],
                optionalResources: [
                  {
                    name: "Node.js Streams Handbook (Week 7)",
                    url: "https://github.com/substack/stream-handbook",
                    hours: 1.0,
                  },
                  {
                    name: "Advanced SQL Techniques",
                    url: "https://towardsdatascience.com/two-advanced-sql-techniques-that-can-drastically-improve-your-queries-81a97c92ddd0/",
                    hours: 0.5,
                  },
                ],
              },
              {
                id: "w2-testing-ci",
                title: "Week 2: Concurrency + Docker + Testing",
                description:
                  "<div><strong>Learning objectives</strong>: Concurrency patterns, optimistic locking, production Docker (multi‚Äëstage), Jest/Supertest, CI/CD.<br/><strong>Deliverables</strong>: CI on PR, coverage uploaded, DB state isolated per test.</div>",
                priority: "high",
                estimatedTime: 18,
                plannedSessions: 6,
                resources: [
                  {
                    name: "PostgreSQL Transaction Isolation",
                    url: "https://www.postgresql.org/docs/current/transaction-iso.html",
                    hours: 1.5,
                  },
                  {
                    name: "Multi-stage Docker for Node.js (Snyk)",
                    url: "https://snyk.io/blog/10-best-practices-to-containerize-nodejs-web-applications-with-docker/",
                    hours: 1.5,
                  },
                  {
                    name: "Jest & Supertest 2025",
                    url: "https://www.youtube.com/watch?v=LEYuxsGIeGo",
                    hours: 1.5,
                  },
                  {
                    name: "GitHub Actions: Node.js CI/CD",
                    url: "https://docs.github.com/actions/guides/building-and-testing-nodejs",
                    hours: 1.0,
                  },
                ],
              },
              {
                id: "w3-auth-security",
                title: "Week 3: Auth + Security",
                description:
                  "<div><strong>Learning objectives</strong>: JWT vs sessions, RBAC implementation, password hashing, token refresh.<br/><strong>Deliverables</strong>: Protected routes with tests; documented flows.</div>",
                priority: "high",
                estimatedTime: 10,
                plannedSessions: 5,
                resources: [
                  {
                    name: "Node.js Security Best Practices",
                    url: "https://nodejs.org/en/docs/guides/security/",
                    hours: 1.0,
                  },
                  {
                    name: "OWASP Authentication Cheat Sheet",
                    url: "https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html",
                    hours: 1.5,
                  },
                  {
                    name: "RBAC vs ABAC (Cloudflare)",
                    url: "https://www.cloudflare.com/learning/access-management/rbac-vs-abac/",
                    hours: 0.75,
                  },
                ],
              },
              {
                id: "w4-openapi",
                title: "Week 4: API Design + Error Handling",
                description:
                  "<div><strong>Learning objectives</strong>: API versioning, pagination (cursor‚Äëbased), error standardization (RFC7807), idempotency.<br/><strong>Deliverables</strong>: /api-docs route with examples; CI schema validation; collection exported.</div>",
                priority: "high",
                pacing: "accelerate",
                estimatedTime: 8,
                plannedSessions: 4,
                resources: [
                  {
                    name: "REST API Best Practices",
                    url: "https://restfulapi.net/",
                    hours: 1.0,
                  },
                  {
                    name: "RFC 7807: Problem Details",
                    url: "https://tools.ietf.org/html/rfc7807",
                    hours: 0.5,
                  },
                  {
                    name: "Stripe Idempotency Keys",
                    url: "https://stripe.com/blog/idempotency",
                    hours: 0.5,
                  },
                ],
              },
              {
                id: "w5-payments-workers",
                title: "Week 5: Async Messaging Concepts + BullMQ",
                description:
                  "<div><strong>Learning objectives</strong>: Messaging patterns, at‚Äëleast‚Äëonce delivery, BullMQ implementation, webhook idempotency.<br/><strong>Deliverables</strong>: Idempotent webhook handler; worker with retry strategy; DLQ docs.</div>",
                priority: "high",
                pacing: "needstime",
                estimatedTime: 10,
                plannedSessions: 5,
                resources: [
                  {
                    name: "Enterprise Integration Patterns (messaging)",
                    url: "https://www.enterpriseintegrationpatterns.com/",
                    hours: 1.0,
                  },
                  {
                    name: "BullMQ Official Docs",
                    url: "https://docs.bullmq.io",
                    hours: 2.0,
                  },
                  {
                    name: "Stripe Webhooks",
                    url: "https://docs.stripe.com/webhooks",
                    hours: 0.8,
                  },
                  {
                    name: "Webhook Idempotency",
                    url: "https://hookdeck.com/webhooks/guides/implement-webhook-idempotency",
                    hours: 0.8,
                  },
                ],
                optionalResources: [
                  {
                    name: "Redis Streams basics (BullMQ internals)",
                    url: "https://redis.io/docs/latest/develop/data-types/streams/",
                    hours: 0.8,
                  },
                  {
                    name: "RabbitMQ/Kafka concepts (overview)",
                    url: "https://www.confluent.io/learn/kafka-vs-rabbitmq/",
                    hours: 0.6,
                  },
                ],
              },
              {
                id: "w6-caching-performance",
                title: "Week 6: Caching + Database Scaling",
                description:
                  "<div><strong>Learning objectives</strong>: Cache‚Äëaside pattern, connection pooling, VACUUM tuning, replication strategies.<br/><strong>Deliverables</strong>: Before/after timings and indexes documented in README.</div>",
                priority: "medium",
                estimatedTime: 8,
                plannedSessions: 4,
                resources: [
                  {
                    name: "Caching Strategies (AWS)",
                    url: "https://aws.amazon.com/caching/best-practices/",
                    hours: 1.0,
                  },
                  {
                    name: "Redis Node.js Guide",
                    url: "https://redis.io/docs/latest/develop/clients/nodejs/",
                    hours: 1.0,
                  },
                  {
                    name: "PostgreSQL Performance Tuning 2025",
                    url: "https://www.pgedge.com/blog/postgresql-performance-tuning",
                    hours: 1.0,
                  },
                  {
                    name: "PostgreSQL Replication",
                    url: "https://www.postgresql.org/docs/current/warm-standby.html",
                    hours: 1.0,
                  },
                ],
              },
              {
                id: "w7-realtime",
                title: "Week 7: Real‚Äëtime + Security Deep Dive",
                description:
                  "<div><strong>Learning objectives</strong>: WebSocket authentication, streams/backpressure, rate limiting, load testing.<br/><strong>Deliverables</strong>: Real‚Äëtime events + basic verification script.</div>",
                priority: "medium",
                estimatedTime: 8,
                plannedSessions: 4,
                resources: [
                  {
                    name: "Socket.IO Official Tutorial",
                    url: "https://socket.io/get-started/chat",
                    hours: 0.8,
                  },
                  {
                    name: "Node.js Streams Deep Dive",
                    url: "https://www.youtube.com/watch?v=GlybFFMXXmQ",
                    hours: 1.0,
                  },
                  {
                    name: "Rate Limiting Algorithms (Stripe)",
                    url: "https://stripe.com/blog/rate-limiters",
                    hours: 0.6,
                  },
                  {
                    name: "k6 Load Testing",
                    url: "https://k6.io/docs/getting-started/running-k6/",
                    hours: 0.8,
                  },
                ],
              },
              {
                id: "w8-ship-project-1",
                title: "Week 8: Ship Project 1 ‚Äì Task/Project SaaS API (Live)",
                description:
                  "<div><strong>Skills</strong>: Deploy (Fly.io), Neon (Postgres), Upstash (Redis), CI/CD.<br/><strong>Deliverables</strong>: Public demo live; OpenAPI at /api-docs; seeds; CI + coverage badges; short runbook; <em>Start applications</em>.<br/><strong>Acceptance</strong>: Demo reachable; docs browsable.<details><summary>Portfolio Artifacts Checklist</summary><ul><li>OpenAPI at /api-docs with examples</li><li>CI badge + coverage badge</li><li>docker-compose.yml</li><li>.env.example</li><li>Seed script</li><li>One‚Äëpage Mermaid system diagram</li><li>CONTRIBUTING, PR template, CODEOWNERS</li><li>Short incident/runbook</li></ul></details></div>",
                priority: "high",
                estimatedTime: 10,
                plannedSessions: 6,
                resources: [
                  { name: "Fly.io Docs", url: "https://fly.io/docs/" },
                  { name: "Neon Docs", url: "https://neon.tech/docs" },
                  {
                    name: "Upstash Redis Docs",
                    url: "https://upstash.com/docs/redis/overall/getstarted",
                  },
                ],
              },
              {
                id: "w9-ecommerce-part1",
                title: "Week 9: NestJS Fundamentals",
                description:
                  "<div><strong>Learning objectives</strong>: Modules, DI, guards, interceptors, pipes, decorators.<br/><strong>Deliverables</strong>: Feature module with guards/pipes; HTTP adapter; testing baseline.</div>",
                priority: "high",
                pacing: "accelerate",
                estimatedTime: 10,
                plannedSessions: 6,
                resources: [
                  {
                    name: "NestJS Full Course 2025 (Ace Dev Hub) ‚Äî Recommended 2025",
                    url: "https://www.youtube.com/watch?v=XVZ10uFY9DU",
                    hours: 6.5,
                  },
                  {
                    name: "NestJS Official Docs",
                    url: "https://docs.nestjs.com/first-steps",
                    hours: 1.0,
                  },
                  {
                    name: "NestJS Best Practices (Project Structure)",
                    url: "https://github.com/CatsMiaow/nestjs-project-structure",
                    hours: 0.5,
                  },
                ],
                optionalResources: [
                  {
                    name: "Net Ninja NestJS Crash Course ‚Äî Alternative",
                    url: "https://www.youtube.com/playlist?list=PL4cUxeGkcC9g8YFseGdkyj9RH9kVs_cMr",
                    hours: 4.0,
                  },
                ],
              },
              {
                id: "w10-ecommerce-part2",
                title: "Week 10: NestJS Advanced + GraphQL",
                description:
                  "<div><strong>Learning objectives</strong>: GraphQL basics, validation pipes, custom decorators, config management.<br/><strong>Deliverables</strong>: GraphQL module + schema, validation strategy, config module.</div>",
                priority: "high",
                estimatedTime: 10,
                plannedSessions: 6,
                resources: [
                  {
                    name: "NestJS GraphQL",
                    url: "https://docs.nestjs.com/graphql/quick-start",
                    hours: 1.0,
                  },
                  {
                    name: "Ace Dev Hub Course ‚Äî Advanced Sections",
                    url: "https://www.youtube.com/watch?v=XVZ10uFY9DU",
                    hours: 2.0,
                  },
                ],
              },
              {
                id: "w11-system-design",
                title: "Week 11: Practical System Design + Advanced Database",
                description:
                  "<div><strong>Learning objectives</strong>: Sharding strategies, partitioning, distributed transactions, MVCC, practical patterns.<br/><strong>Deliverables</strong>: 2‚Äì3 short case studies with Mermaid diagrams and trade‚Äëoffs; ADRs added; <em>Sharding/partitioning design document</em>.</div>",
                priority: "medium",
                pacing: "needstime",
                estimatedTime: 8,
                plannedSessions: 4,
                resources: [
                  {
                    name: "System Design Primer (focused)",
                    url: "https://github.com/donnemartin/system-design-primer",
                    hours: 3.0,
                  },
                  {
                    name: "PostgreSQL Partitioning",
                    url: "https://www.postgresql.org/docs/current/ddl-partitioning.html",
                    hours: 1.0,
                  },
                  {
                    name: "GeeksforGeeks Case Studies",
                    url: "https://geeksforgeeks.org/system-design/case-studies-in-system-design/",
                    hours: 2.0,
                  },
                  {
                    name: "PostgreSQL MVCC",
                    url: "https://www.postgresql.org/docs/current/mvcc.html",
                    hours: 1.0,
                  },
                ],
              },
              {
                id: "w12-interview-prep",
                title: "Week 12: Advanced Testing + Observability",
                description:
                  "<div><strong>Learning objectives</strong>: Contract testing, load testing, observability (logs/metrics/traces), SLOs.<br/><strong>Deliverables</strong>: Ship Project 2 + advanced tests; question bank + notes committed.</div>",
                priority: "low",
                pacing: "needstime",
                estimatedTime: 8,
                plannedSessions: 5,
                resources: [
                  {
                    name: "Testing Microservices (Martin Fowler)",
                    url: "https://martinfowler.com/articles/microservice-testing/",
                    hours: 1.0,
                  },
                  {
                    name: "Observability 101 (Honeycomb)",
                    url: "https://www.honeycomb.io/blog/observability-engineering-101",
                    hours: 1.0,
                  },
                  {
                    name: "Pino Structured Logging",
                    url: "https://getpino.io/",
                    hours: 0.5,
                  },
                ],
              },
              {
                id: "w15-dsa-warmup",
                title: "Week 15‚Äì16: DSA Warm-up",
                description:
                  "<div><strong>Learning objectives</strong>: Pattern recognition (arrays, hashing, two pointers) ‚Äî not deep grinding.<br/><strong>Hours</strong>: 12‚Äì15 total (30‚Äì45 min/day). <strong>Pacing</strong>: Can accelerate to 10‚Äì12 hrs if backend roles prioritized.</div>",
                priority: "low",
                pacing: "accelerate",
                estimatedTime: 13,
                plannedSessions: 8,
                resources: [
                  {
                    name: "NeetCode Roadmap ‚Äî PRIMARY",
                    url: "https://neetcode.io/roadmap",
                    hours: 6.0,
                  },
                  {
                    name: "Blind 75 (reference)",
                    url: "https://neetcode.io/practice",
                    hours: 3.0,
                  },
                ],
              },
            ],
          },
        ],
        projects: [
          { id: "project1", title: "Project 1 ‚Äì Task/Project SaaS API" },
          { id: "project2", title: "Project 2 ‚Äì Headless E‚Äëcommerce API" },
        ],
        curatedResources: [],
        advancedTopics: [
          {
            id: "adv-kubernetes",
            title: "Kubernetes Fundamentals (4‚Äì6 weeks post‚Äëoffer)",
            description:
              "Workloads, services/ingress, health probes, HPA, zero‚Äëdowntime deploys.",
            importance: "Post‚Äëoffer specialization",
            resources: [],
          },
          {
            id: "adv-terraform",
            title: "Terraform/IaC & Secrets",
            description:
              "Infra modules, remote state, secure secret handling (SOPS/Cloud KMS).",
            importance: "Post‚Äëoffer",
            resources: [],
          },
          {
            id: "adv-microservices",
            title: "Microservices & Messaging",
            description:
              "Service boundaries, idempotency, saga/outbox patterns, contracts.",
            importance: "Post‚Äëoffer",
            resources: [],
          },
          {
            id: "adv-observability",
            title: "Observability",
            description:
              "OpenTelemetry traces + metrics + logs; SLOs and alerting.",
            importance: "Post‚Äëoffer",
            resources: [],
          },
        ],
      };

      // Active roadmap state (default to V2)
      let currentRoadmap = roadmapDataV2;
      let currentVersion = "v2";

      // State management
      let progressData = {
        tasks: {},
        notes: {},
        timeSpent: {},
        progress: {}, // Learning progress percentage (0-100)
        lastUpdated: null,
        sessions: {},
        resourceCompleted: {},
        resourceProgress: {},
        gates: { project1: {}, project2: {} }
      };

      // Chart instances
      let phaseChart = null;
      let timeChart = null;
      let importData = null;
      const GATES = [
        "testing",
        "apiDocs",
        "security",
        "reliability",
        "ops",
        "design",
      ];

      // Initialize the application
      function init() {
        loadProgressFromStorage();
        
        // Try to restore version from storage if exists, otherwise default to V3
        if (progressData.version) {
           switchVersion(progressData.version, false);
        } else {
           switchVersion("v3", false);
        }
        
        // Load problems solved count
        const psInput = document.getElementById('problemsSolvedInput');
        if (psInput && progressData.problemsSolved) {
            psInput.value = progressData.problemsSolved;
        }
        
        reconcileProgressWithTasks();
        recomputeAllTopicProgressFromResources();
        
        // UI Render
        renderRoadmap();
        updateVisibilityForVersion();
        renderResourcesGrid();
        
        // Only render specific sections for V1
        if (currentVersion === 'v1') {
            renderGates();
            renderAdvancedTopics();
            renderExpressNest();
            renderJobCoverage();
            updateReadinessUI();
            updateRoleFitUI();
        }
        
        updateStats();
        initCharts();
        
        // Collapse Competency Gates by default
        const gatesEl = document.getElementById("gates");
        if (gatesEl && !gatesEl.classList.contains("collapsed")) {
          gatesEl.classList.add("collapsed");
        }
      }
      
      function switchVersion(version, save = true) {
          currentVersion = version;
          document.getElementById("versionSelect").value = version;
          
          if (version === 'v1') {
              currentRoadmap = roadmapDataV1;
              document.getElementById("heroTitle").innerText = "Backend-First Senior Roadmap";
              document.getElementById("heroSubtitle").innerText = "Core 12‚ÄëWeek Track ¬∑ Ship 2 backends by Weeks 8‚Äì10";
          } else if (version === 'v2') {
              currentRoadmap = roadmapDataV2;
              document.getElementById("heroTitle").innerText = "Sophisticated Engineer Roadmap (Legacy)";
              document.getElementById("heroSubtitle").innerText = "Data Structures, Algorithms, and C++ Mastery - 6 Month Plan";
          } else {
              currentRoadmap = roadmapDataV3;
              document.getElementById("heroTitle").innerText = "DSA Mastery Roadmap";
              document.getElementById("heroSubtitle").innerText = "Master DSA in 4 Months ¬∑ 150-200 Problems ¬∑ Abdul Bari + NeetCode";
          }
          
          if (save) {
              if (!progressData) progressData = {};
              progressData.version = version;
              saveProgressToStorage();
              
              // Re-render everything
              renderRoadmap();
              updateVisibilityForVersion();
              renderResourcesGrid();
              
              if (currentVersion === 'v1') {
                  renderGates();
                  renderAdvancedTopics();
                  renderExpressNest();
                  renderJobCoverage();
                  updateReadinessUI();
                  updateRoleFitUI();
              }
              
              updateStats();
              updateCharts(); // Re-init charts with new data
          }
      }
      
      function updateVisibilityForVersion() {
          const v1Elements = document.querySelectorAll('.v1-only');
          v1Elements.forEach(el => {
              if (currentVersion === 'v1') {
                  el.classList.remove('hidden');
              } else {
                  el.classList.add('hidden');
              }
          });
          
          const v3Elements = document.querySelectorAll('.v3-only');
          v3Elements.forEach(el => {
              if (currentVersion === 'v3') {
                  el.classList.remove('hidden');
              } else {
                  el.classList.add('hidden');
              }
          });
          
          const advSection = document.getElementById('advanced-section');
          if (currentVersion === 'v2' || currentVersion === 'v3') {
              advSection.classList.add('hidden');
          } else {
              advSection.classList.remove('hidden');
          }
      }

      // Render the roadmap structure
      function renderRoadmap() {
        const container = document.getElementById("roadmapContent");
        container.innerHTML = "";
        
        document.getElementById("roadmap-track-title").innerText = currentRoadmap.learningObjectives[0].title;

        currentRoadmap.learningObjectives.forEach((objective) => {
            // For V2 we might have just one objective but many topics (Phases)
            // We can just render the topics directly if we want, but reusing structure is easier
            // For V2, let's skip the outer "Objective" wrapper if there is only one and just render Topics? 
            // The existing code renders "Phase" (Objective) -> Topics inside.
            // V1 has 1 Objective ("Core 12-Week"). V2 has 1 Objective ("Sophisticated Engineer").
            // So the structure holds.
            
            // BUT, existing code wraps objective in a div.phase.
            // Inside it puts topics.
            
            // V1: "Core 12-Week Track" (Objective) -> "Week 1" (Topic)
            // V2: "Sophisticated Engineer Track" (Objective) -> "Phase 1" (Topic)
            
            // Actually, let's unwrap the V2 objective to make it look better, 
            // OR just rename the Objective title to "Phases"
            // The prompt says "Refactor... so that the roadmap nodes are dynamically loaded".
            // I will stick to the existing hierarchy: Objective -> Topics.
            
            const objectiveElement = createObjectiveElement(objective);
            container.appendChild(objectiveElement);
        });
      }

      // Create learning objective element
      function createObjectiveElement(objective) {
        const objectiveDiv = document.createElement("div");
        objectiveDiv.className = "phase";
        // Auto-expand if V2
        if (currentVersion === 'v2') objectiveDiv.className = "phase"; // Not collapsed
        
        objectiveDiv.innerHTML = `
                <div class="phase-header" onclick="togglePhase('${
                  objective.id
                }')">
                    <div class="phase-header-content">
                        <div class="phase-title">
                            <span class="phase-icon">${objective.icon}</span>
                            <span class="expand-icon">‚ñº</span>
                            ${objective.title}
                        </div>
                        <div class="phase-progress" id="progress-${
                          objective.id
                        }">0% Complete</div>
                    </div>
                </div>
                <div class="phase-content" id="content-${objective.id}">
                    <div class="objective-description">${
                      objective.description
                    }</div>
                    ${objective.topics
                      .map((topic) => createTopicElement(topic, objective.id))
                      .join("")}
                </div>
            `;
        return objectiveDiv;
      }

      // Create topic element
      function createTopicElement(topic, objectiveId) {
        const isCompleted = progressData.tasks[topic.id] || false;
        const sessions =
          (progressData.sessions && progressData.sessions[topic.id]) || 0;
        const learningProgress =
          typeof progressData.progress[topic.id] === "number"
            ? progressData.progress[topic.id]
            : 0;
        const notes = progressData.notes[topic.id] || "";
        const completedClass = isCompleted ? "completed" : "";

        return `
                <div class="topic ${completedClass}" id="topic-${topic.id}">
                    <div class="topic-header">
                        <div class="checkbox-container">
                            <input type="checkbox" class="checkbox" id="task-${
                              topic.id
                            }" 
                                   ${isCompleted ? "checked" : ""} 
                                   onchange="updateTaskProgress('${topic.id}')">
                            <label for="task-${topic.id}" class="topic-title">${
          topic.title
        }</label>
                        </div>
                        <span class="priority-badge priority-${
                          topic.priority
                        }">${topic.priority}</span>
                        ${
                          topic.pacing
                            ? `<span class="pacing-badge ${
                                topic.pacing === "accelerate"
                                  ? "pacing-accelerate"
                                  : "pacing-needstime"
                              }">${
                                topic.pacing === "accelerate"
                                  ? "‚ö° Can Accelerate"
                                  : "‚è∞ Needs Time"
                              }</span>`
                            : ""
                        }
                        ${
                          topic.isPrerequisites
                            ? '<span class="pacing-badge prereq-badge">Prerequisites</span>'
                            : ""
                        }
                    </div>
                    <div class="topic-description">${topic.description}</div>
                    
                    ${topic.engineeringLogic ? `
                        <div class="engineering-logic">
                            <span class="engineering-logic-title">üí° Engineering Logic</span>
                            ${topic.engineeringLogic}
                        </div>
                    ` : ''}
                    
                    ${topic.successMetric ? `
                        <div class="success-metric">
                            <strong>üéØ Success Metric:</strong> ${topic.successMetric}
                        </div>
                    ` : ''}

                    ${
                      topic.focusAreas
                        ? `
                        <div class="focus-areas">
                            <strong>üìé Focus Areas:</strong> ${topic.focusAreas}
                        </div>
                    `
                        : ""
                    }
                    
                    ${topic.keyTopics && topic.keyTopics.length ? `
                        <div class="focus-areas" style="margin-top:0.5rem">
                            <strong>üîë Key Topics:</strong>
                            <ul style="padding-left: 1.2rem; margin-top: 0.25rem">
                                ${topic.keyTopics.map(t => `<li>${t}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <div class="time-tracker">
                        <div class="time-item">
                            <div class="time-label">Planned</div>
                            <div class="time-value">${
                              topic.plannedSessions || 0
                            } session${
          (topic.plannedSessions || 0) === 1 ? "" : "s"
        }</div>
                        </div>
                        <div class="time-item">
                            <div class="time-label">Sessions</div>
                            <input type="number" id="sess-${
                              topic.id
                            }" class="time-input" 
                                   value="${sessions}" min="0" step="1" 
                                   onchange="updateSessions('${
                                     topic.id
                                   }', this.value)">
                        </div>
                        <div class="time-item">
                            <div class="time-label">Learning Progress</div>
                            <div class="time-value" id="topicprog-${
                              topic.id
                            }">${learningProgress}%</div>
                        </div>
                    </div>
                    ${
                      Array.isArray(topic.resources) && topic.resources.length
                        ? `
                        <div class="resources">
                            <div class="resources-title">üìö Resources (per‚Äëresource progress drives this topic)</div>
                            <div>
                                ${topic.resources
                                  .map((r) => {
                                    const rid =
                                      `${topic.id}-` +
                                      btoa(r.url).replace(/=/g, "");
                                    const checked =
                                      progressData.resourceCompleted &&
                                      progressData.resourceCompleted[rid]
                                        ? "checked"
                                        : "";
                                    const rprog =
                                      progressData.resourceProgress &&
                                      typeof progressData.resourceProgress[
                                        rid
                                      ] === "number"
                                        ? progressData.resourceProgress[rid]
                                        : checked
                                        ? 100
                                        : 0;
                                    const hoursLabel =
                                      typeof r.hours === "number"
                                        ? ` <span class="time-label">~${r.hours}h</span>`
                                        : "";
                                    return `<div class="resource-row">
                                        <input type="checkbox" id="reschk-${rid}" ${checked} onchange="toggleResource('${rid}','${topic.id}')">
                                        <a href="${r.url}" target="_blank" class="resource-link">${r.name}</a>
                                        <input type="range" min="0" max="100" step="5" class="resource-slider" value="${rprog}" onchange="updateResourceProgress('${rid}','${topic.id}', this.value)">
                                        <span class="resource-progress" id="resprog-${rid}">${rprog}%</span>${hoursLabel}
                                    </div>`;
                                  })
                                  .join("")}
                            </div>
                        </div>
                    `
                        : ""
                    }
                    ${
                      Array.isArray(topic.optionalResources) &&
                      topic.optionalResources.length
                        ? `
                        <div class="resources">
                            <div class="resources-title">üß© Optional</div>
                            <div>
                                ${topic.optionalResources
                                  .map((r) => {
                                    const rid =
                                      `${topic.id}-` +
                                      btoa(r.url).replace(/=/g, "");
                                    const checked =
                                      progressData.resourceCompleted &&
                                      progressData.resourceCompleted[rid]
                                        ? "checked"
                                        : "";
                                    const rprog =
                                      progressData.resourceProgress &&
                                      typeof progressData.resourceProgress[
                                        rid
                                      ] === "number"
                                        ? progressData.resourceProgress[rid]
                                        : checked
                                        ? 100
                                        : 0;
                                    const hoursLabel =
                                      typeof r.hours === "number"
                                        ? ` <span class="time-label">~${r.hours}h</span>`
                                        : "";
                                    return `<div class="resource-row">
                                        <input type="checkbox" id="reschk-${rid}" ${checked} onchange="toggleResource('${rid}','${topic.id}')">
                                        <a href="${r.url}" target="_blank" class="resource-link">${r.name}</a>
                                        <input type="range" min="0" max="100" step="5" class="resource-slider" value="${rprog}" onchange="updateResourceProgress('${rid}','${topic.id}', this.value)">
                                        <span class="resource-progress" id="resprog-${rid}">${rprog}%</span>${hoursLabel}
                                    </div>`;
                                  })
                                  .join("")}
                            </div>
                        </div>
                    `
                        : ""
                    }
                    <div class="notes-container">
                        <textarea class="notes-input" id="notes-${topic.id}" 
                                  placeholder="üìù Add your learning notes, insights, or challenges here..." 
                                  onchange="updateNotes('${
                                    topic.id
                                  }', this.value)">${notes}</textarea>
                    </div>
                </div>
            `;
      }

      // Render advanced topics
      function renderAdvancedTopics() {
        const container = document.getElementById("advancedTopics");
        if (!currentRoadmap.advancedTopics) {
             container.innerHTML = "";
             return;
        }
        
        container.innerHTML = currentRoadmap.advancedTopics
          .map(
            (topic) => `
                <div class="advanced-topic">
                    <div class="advanced-topic-title">üåü ${topic.title}</div>
                    <div class="advanced-topic-desc">${topic.description}</div>
                    <div class="advanced-topic-importance"><strong>Why Important:</strong> ${
                      topic.importance
                    }</div>
                    ${
                      topic.resources
                        ? `
                        <div class="resources">
                            <div class="resources-title">üìö Learning Resources</div>
                            <div class="resource-links">
                                ${topic.resources
                                  .map(
                                    (resource) => `
                                    <a href="${resource.url}" target="_blank" class="resource-link">${resource.name}</a>
                                `
                                  )
                                  .join("")}
                            </div>
                        </div>
                    `
                        : ""
                    }
                </div>
            `
          )
          .join("");
      }

      // Toggle learning objective visibility
      function togglePhase(objectiveId) {
        const objectiveElement = document.querySelector(
          `#content-${objectiveId}`
        ).parentElement;
        objectiveElement.classList.toggle("collapsed");
      }

      // Update task progress with gamification
      function updateTaskProgress(taskId) {
        const checkbox = document.getElementById(`task-${taskId}`);
        const wasCompleted = progressData.tasks[taskId];

        progressData.tasks[taskId] = checkbox.checked;
        progressData.lastUpdated = new Date().toISOString();

        // Add visual feedback
        const topicElement = checkbox.closest(".topic");
        const topic = findTopicById(taskId);

        if (checkbox.checked) {
          topicElement.classList.add("completed");
          
          // 1. Set Topic Progress to 100
          progressData.progress[taskId] = 100;
          
          // 2. Update Topic UI Text
          const progressEl = document.getElementById(`topicprog-${taskId}`);
          if (progressEl) progressEl.textContent = "100%";

          // 3. Update All Resources (Data & UI) to 100%
          if (topic) {
             const resources = [...(topic.resources || []), ...(topic.optionalResources || [])];
             resources.forEach(r => {
                 const rid = `${taskId}-` + btoa(r.url).replace(/=/g, "");
                 
                 // Data Update
                 if (!progressData.resourceCompleted) progressData.resourceCompleted = {};
                 if (!progressData.resourceProgress) progressData.resourceProgress = {};
                 progressData.resourceCompleted[rid] = true;
                 progressData.resourceProgress[rid] = 100;
                 
                 // UI Update - Checkbox
                 const resChk = document.getElementById(`reschk-${rid}`);
                 if (resChk) {
                     resChk.checked = true;
                     // UI Update - Slider (find relative to checkbox)
                     const row = resChk.closest('.resource-row');
                     if (row) {
                         const slider = row.querySelector('.resource-slider');
                         if (slider) slider.value = 100;
                     }
                 }
                 
                 // UI Update - Text Label
                 const resLabel = document.getElementById(`resprog-${rid}`);
                 if (resLabel) resLabel.textContent = "100%";
             });
          }

          if (!wasCompleted) {
            showAchievement("üéâ Challenge Completed!");
          }
        } else {
          topicElement.classList.remove("completed");
          // Reset learning progress when unchecking to reflect not learned
          progressData.progress[taskId] = 0;
          
          const progressEl = document.getElementById(`topicprog-${taskId}`);
          if (progressEl) progressEl.textContent = "0%";
        }

        saveProgressToStorage();
        updateStats();
        updateCharts();
      }

      // Update sessions
      function updateSessions(taskId, value) {
        if (!progressData.sessions) progressData.sessions = {};
        progressData.sessions[taskId] = parseInt(value, 10) || 0;
        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
        updateStats();
        updateCharts();
      }
      
      // Update problems solved count (V3 only)
      function updateProblemsSolved(value) {
        progressData.problemsSolved = parseInt(value, 10) || 0;
        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
      }

      // Update learning progress
      function updateLearningProgress(taskId, progressPercent) {
        const progress = Math.max(
          0,
          Math.min(100, parseFloat(progressPercent) || 0)
        );
        progressData.progress[taskId] = progress;
        progressData.lastUpdated = new Date().toISOString();

        // Auto-check the task if progress reaches 100%
        if (progress >= 100 && !progressData.tasks[taskId]) {
          progressData.tasks[taskId] = true;
          const checkbox = document.getElementById(`task-${taskId}`);
          if (checkbox) {
            checkbox.checked = true;
            const topicElement = checkbox.closest(".topic");
            topicElement.classList.add("completed");
            showAchievement("üéâ Challenge Completed!");
          }
        }

        saveProgressToStorage();
        updateStats();
        updateCharts();
      }

      // Update notes
      function updateNotes(taskId, notes) {
        progressData.notes[taskId] = notes;
        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
      }

      // Find topic by ID
      function findTopicById(topicId) {
        for (const objective of currentRoadmap.learningObjectives) {
          for (const topic of objective.topics) {
            if (topic.id === topicId) {
              return topic;
            }
          }
        }
        return null;
      }

      // Show achievement notification
      function showAchievement(message) {
        const achievement = document.createElement("div");
        achievement.className = "achievement";
        achievement.textContent = message;
        document.body.appendChild(achievement);

        setTimeout(() => achievement.classList.add("show"), 100);
        setTimeout(() => {
          achievement.classList.remove("show");
          setTimeout(() => document.body.removeChild(achievement), 500);
        }, 3000);
      }

      // Calculate statistics (Pure percentage based)
      function calculateStats() {
        let totalTasks = 0;
        let completedTasks = 0;
        let totalSessions = 0;
        let totalPlannedSessions = 0;
        let progressSum = 0;

        currentRoadmap.learningObjectives.forEach((objective) => {
          objective.topics.forEach((topic) => {
            totalTasks++;
            
            // Keep tracking sessions for stats cards
            const plannedRaw = topic.plannedSessions || 0;
            const pacingFactor = topic.pacing === "accelerate" ? 0.5 : 1;
            const planned = Math.max(1, Math.round(plannedRaw * pacingFactor));
            totalPlannedSessions += planned;
            totalSessions +=
              (progressData.sessions && progressData.sessions[topic.id]) || 0;
            
            if (progressData.tasks[topic.id]) {
              completedTasks++;
            }
            
            // Sum percentage directly (no weighting)
            // computeTopicProgressFromResources returns 0-100
            const topicProgress = computeTopicProgressFromResources(topic);
            progressSum += topicProgress;
          });
        });

        // Average of all topic percentages
        const overallProgress =
          totalTasks > 0
            ? Math.round(progressSum / totalTasks)
            : 0;

        return {
          overallProgress,
          completedTasks,
          totalTasks,
          totalSessions,
          totalPlannedSessions,
        };
      }

      // Update statistics display
      function updateStats() {
        const stats = calculateStats();
        const { completedResources, totalResources } = computeResourceStats();

        document.getElementById("overallProgress").textContent =
          stats.overallProgress + "%";
        // Show resources completed count in the Resources Completed card
        const rcEl = document.getElementById("completedTasks");
        if (rcEl) rcEl.textContent = `${completedResources}/${totalResources}`;
        const tsEl = document.getElementById("totalSessions");
        const psEl = document.getElementById("plannedSessions");
        if (tsEl) tsEl.textContent = stats.totalSessions;
        if (psEl) psEl.textContent = stats.totalPlannedSessions;

        // Update progress ring
        const circumference = 2 * Math.PI * 50;
        const progressCircle = document.getElementById("progressCircle");
        const offset =
          circumference - (stats.overallProgress / 100) * circumference;
        progressCircle.style.strokeDasharray = circumference;
        progressCircle.style.strokeDashoffset = offset;

        // Update learning objective progress
        currentRoadmap.learningObjectives.forEach((objective) => {
          const objectiveStats = calculateObjectiveStats(objective);
          const progressElement = document.getElementById(
            `progress-${objective.id}`
          );
          if (progressElement) {
            progressElement.textContent = `${objectiveStats.progress}% Complete`;
          }
          // Also update per-topic displayed value
          objective.topics.forEach((topic) => {
            const el = document.getElementById(`topicprog-${topic.id}`);
            if (el) {
              const topicPct = computeTopicProgressFromResources(topic);
              el.textContent = `${topicPct}%`;
            }
          });
        });

        // Update readiness gauge (Only visible in V1)
        if (currentVersion === 'v1') {
            updateReadinessUI();
            updateRoleFitUI();
        }
      }

      // Compute resource completion counts across all topics (core + optional)
      function computeResourceStats() {
        let totalResources = 0;
        let completedResources = 0;
        (currentRoadmap.learningObjectives || []).forEach((objective) => {
          (objective.topics || []).forEach((topic) => {
            const allR = [];
            if (Array.isArray(topic.resources)) allR.push(...topic.resources);
            if (Array.isArray(topic.optionalResources))
              allR.push(...topic.optionalResources);
            allR.forEach((r) => {
              totalResources += 1;
              const rid = `${topic.id}-` + btoa(r.url).replace(/=/g, "");
              const checked =
                progressData.resourceCompleted &&
                !!progressData.resourceCompleted[rid];
              const val =
                progressData.resourceProgress &&
                typeof progressData.resourceProgress[rid] === "number"
                  ? progressData.resourceProgress[rid]
                  : checked
                  ? 100
                  : 0;
              if (val >= 100 || checked) completedResources += 1;
            });
          });
        });
        return { completedResources, totalResources };
      }

      // Calculate learning objective statistics (session-weighted)
      function calculateObjectiveStats(objective) {
        let totalTasks = 0;
        let completedTasks = 0;
        let totalSessions = 0;
        let totalPlanned = 0;
        let weightedProgressSum = 0;

        objective.topics.forEach((topic) => {
          totalTasks++;
          const pacingFactor = topic.pacing === "accelerate" ? 0.5 : 1;
          const planned = Math.max(
            1,
            Math.round((topic.plannedSessions || 0) * pacingFactor)
          );
          totalPlanned += planned;
          totalSessions +=
            (progressData.sessions && progressData.sessions[topic.id]) || 0;
          if (progressData.tasks[topic.id]) {
            completedTasks++;
          }
          const topicProgress = computeTopicProgressFromResources(topic);
          weightedProgressSum +=
            (planned || 1) * (Math.max(0, Math.min(100, topicProgress)) / 100);
        });

        const weightedProgress =
          totalPlanned > 0
            ? Math.round((weightedProgressSum / totalPlanned) * 100)
            : 0;

        return {
          progress: weightedProgress,
          completedTasks,
          totalTasks,
          totalSessions,
          totalPlanned,
        };
      }

      // Gate-based readiness
      function getGateCounts() {
        const gates = progressData.gates || {};
        const p1 = gates.project1 || {};
        const p2 = gates.project2 || {};
        const p1Passed = GATES.filter((g) => !!p1[g]).length;
        const p2Passed = GATES.filter((g) => !!p2[g]).length;
        const totalPassed = p1Passed + p2Passed;
        const totalGates = GATES.length * 2;
        return { p1Passed, p2Passed, totalPassed, totalGates };
      }

      function calculateReadiness() {
        const { totalPassed, totalGates } = getGateCounts();
        const pct =
          totalGates > 0 ? Math.round((totalPassed / totalGates) * 100) : 0;
        return Math.max(0, Math.min(100, pct));
      }

      function updateReadinessUI() {
        const readiness = calculateReadiness();
        const valueEl = document.getElementById("readinessValue");
        const circle = document.getElementById("readinessCircle");
        if (valueEl) valueEl.textContent = readiness + "%";
        if (circle) {
          const circumference = 2 * Math.PI * 50;
          const offset = circumference - (readiness / 100) * circumference;
          circle.style.strokeDasharray = circumference;
          circle.style.strokeDashoffset = offset;
        }
      }

      function calculateReadinessTracks() {
        const gates = progressData.gates || {};
        const p1 = gates.project1 || {};
        const p2 = gates.project2 || {};
        const p1Ratio = GATES.filter((g) => !!p1[g]).length / GATES.length;
        const p2Ratio = GATES.filter((g) => !!p2[g]).length / GATES.length;
        const avg = (p1Ratio + p2Ratio) / 2;
        const feHeavy = Math.round(Math.max(p1Ratio, p2Ratio) * 100);
        const backendMid = Math.round(avg * 100);
        const bothAll = p1Ratio === 1 && p2Ratio === 1;
        const perfWin = !!p1.perfWin || !!p2.perfWin;
        const fsBalanced = bothAll && perfWin ? 100 : Math.round(avg * 100);
        return { feHeavy, backendMid, fsBalanced };
      }

      function updateRoleFitUI() {
        const { feHeavy, backendMid, fsBalanced } = calculateReadinessTracks();

        const feHeavyScore = document.getElementById("rf-fe-heavy-score");
        const backendMidScore = document.getElementById("rf-backend-mid-score");
        const fsBalancedScore = document.getElementById("rf-fs-balanced-score");

        if (feHeavyScore) feHeavyScore.textContent = feHeavy + "%";
        if (backendMidScore) backendMidScore.textContent = backendMid + "%";
        if (fsBalancedScore) fsBalancedScore.textContent = fsBalanced + "%";
      }

      // Initialize charts
      function initCharts() {
        // Cleanup existing
        if (phaseChart) phaseChart.destroy();
        if (timeChart) timeChart.destroy();
        
        if (currentVersion === 'v1') {
            const phaseCtx = document.getElementById("phaseChart").getContext("2d");
            phaseChart = new Chart(phaseCtx, {
              type: "doughnut",
              data: {
                labels: ["Project 1", "Project 2"],
                datasets: [
                  {
                    data: [0, 0],
                    backgroundColor: [
                      "rgba(100, 255, 218, 0.8)",
                      "rgba(187, 134, 252, 0.8)",
                    ],
                    borderWidth: 2,
                    borderColor: "rgba(255, 255, 255, 0.1)",
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: "bottom",
                    labels: {
                      color: "rgba(255, 255, 255, 0.8)",
                      font: { size: 10, weight: "500" },
                    },
                  },
                },
              },
            });
        }

        const topics = (currentRoadmap.learningObjectives[0]?.topics || []).filter(
          (t) => !t.isPrerequisites && !/week 15/i.test(t.title)
        );
        const weeks = topics.map((_, i) => `W${i + 1}`);
        
        const timeCtx = document.getElementById("timeChart").getContext("2d");
        timeChart = new Chart(timeCtx, {
          type: "bar",
          data: {
            labels: weeks,
            datasets: [
              {
                label: "Planned",
                data: topics.map((t) => t.plannedSessions || 0),
                backgroundColor: "rgba(255, 255, 255, 0.2)",
                borderColor: "rgba(255, 255, 255, 0.3)",
                borderWidth: 1,
              },
              {
                label: "Completed",
                data: topics.map(() => 0),
                backgroundColor: "rgba(100, 255, 218, 0.8)",
                borderColor: "rgba(100, 255, 218, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Sessions",
                  color: "rgba(255, 255, 255, 0.8)",
                },
                ticks: { color: "rgba(255, 255, 255, 0.8)" },
                grid: { color: "rgba(255, 255, 255, 0.1)" },
              },
              x: {
                ticks: { color: "rgba(255, 255, 255, 0.8)", maxRotation: 45 },
                grid: { color: "rgba(255, 255, 255, 0.1)" },
              },
            },
            plugins: {
              legend: {
                labels: {
                  color: "rgba(255, 255, 255, 0.8)",
                  font: { size: 12, weight: "500" },
                },
              },
            },
          },
        });

        updateCharts();
      }

      // Update charts with current data
      function updateCharts() {
        // Update gate passes chart (V1 only)
        if (currentVersion === 'v1' && phaseChart) {
            const { p1Passed, p2Passed } = getGateCounts();
            phaseChart.data.datasets[0].data = [p1Passed, p2Passed];
            phaseChart.update();
        }

        // Update time chart with week data
        if (timeChart) {
            const topics = (currentRoadmap.learningObjectives[0]?.topics || []).filter(
              (t) => !t.isPrerequisites && !/week 15/i.test(t.title)
            );
            const actualSessions = topics.map(
              (t) => (progressData.sessions && progressData.sessions[t.id]) || 0
            );
            const plannedSessions = topics.map((t) => t.plannedSessions || 0);
            timeChart.data.labels = topics.map((_, i) => `P${i+1}`); // Use P for Phase in V2? Or just W.
            if (currentVersion === 'v2') {
                 timeChart.data.labels = topics.map((_, i) => `Ph${i+1}`);
            }
            
            timeChart.data.datasets[0].data = plannedSessions;
            timeChart.data.datasets[1].data = actualSessions;
            timeChart.update();
        }
      }

      // Storage functions
      function saveProgressToStorage() {
        localStorage.setItem("roadmapProgress", JSON.stringify(progressData));
      }

      function loadProgressFromStorage() {
        const saved = localStorage.getItem("roadmapProgress");
        if (saved) {
          progressData = JSON.parse(saved);
          // Ensure progress field exists for backward compatibility
          if (!progressData.progress) {
            progressData.progress = {};
          }
          if (!progressData.gates) {
            progressData.gates = { project1: {}, project2: {} };
          }
          if (!progressData.sessions) {
            progressData.sessions = {};
          }
          if (!progressData.resourceCompleted) {
            progressData.resourceCompleted = {};
          }
          if (!progressData.resourceProgress) {
            progressData.resourceProgress = {};
          }
          if (typeof progressData.problemsSolved !== 'number') {
            progressData.problemsSolved = 0;
          }
        }
      }

      // Reconcile imported/saved data:
      function reconcileProgressWithTasks() {
        // Loop through BOTH versions if possible, or just current?
        // Best to reconcile current.
        
        currentRoadmap.learningObjectives.forEach((objective) => {
          objective.topics.forEach((topic) => {
            const id = topic.id;
            const checked = !!progressData.tasks[id];
            if (!checked) {
              progressData.progress[id] = 0;
            } else if (typeof progressData.progress[id] !== "number") {
              progressData.progress[id] = 100;
            }
            if (typeof progressData.timeSpent[id] !== "number") {
              progressData.timeSpent[id] = 0;
            }
          });
        });
        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
      }

      // Gates UI
      function renderGates() {
        if (!progressData.gates) {
          progressData.gates = { project1: {}, project2: {} };
        }
        const container = document.getElementById("gatesContent");
        const gates = progressData.gates;
        const remediation = {
          testing: "Add Jest+Supertest, isolate DB, publish coverage",
          apiDocs: "Serve OpenAPI at /api-docs; validate with Spectral in CI",
          security:
            "Add Zod validators, helmet headers, rate limiter (ioredis)",
          reliability:
            "Idempotent Stripe webhooks; retries/backoff; DLQ documented",
          ops: "docker-compose.yml, .env.example, seed, GH Actions deploy",
          design: "One‚Äëpage Mermaid diagram + 2 ADRs per project",
        };
        const label = {
          testing: "Testing",
          apiDocs: "API Docs",
          security: "Security",
          reliability: "Reliability",
          ops: "Ops",
          design: "Design",
        };
        function projectBlock(pid, title) {
          const state = gates[pid] || {};
          const chips = GATES.map((g) => {
            const passed = !!state[g];
            const color = passed ? "var(--accent-green)" : "var(--accent-pink)";
            const txt = passed ? "Pass" : "Fail";
            return `<div style="display:flex;align-items:center;gap:.5rem;margin:.25rem 0;">
                        <span class="week-progress" role="button" tabindex="0" style="cursor:pointer;color:${color}" onclick="toggleGate('${pid}','${g}')">${
              label[g]
            }: ${txt}</span>
                        <span style="color:var(--text-muted);font-size:.85rem;">${
                          passed ? "" : remediation[g]
                        }</span>
                    </div>`;
          }).join("");
          const perfColor = state.perfWin
            ? "var(--accent-green)"
            : "var(--accent-pink)";
          const perfTxt = state.perfWin ? "Recorded" : "Missing";
          const perf = `<div style="display:flex;align-items:center;gap:.5rem;margin:.5rem 0;">
                    <span class="week-progress" role="button" tabindex="0" style="cursor:pointer;color:${perfColor}" onclick="togglePerf('${pid}')">Performance Win: ${perfTxt}</span>
                    <span style="color:var(--text-muted);font-size:.85rem;">Indexing/cache improvement with timings</span>
                </div>`;
          return `<div class="topic"><div class="topic-header"><div class="checkbox-container"><label class="topic-title">${title}</label></div></div>${chips}${perf}</div>`;
        }
        container.innerHTML = [
          projectBlock("project1", "Project 1 ‚Äì Task/Project SaaS API"),
          projectBlock("project2", "Project 2 ‚Äì Headless E‚Äëcommerce API"),
        ].join("");
      }

      function toggleGate(projectId, gate) {
        if (!progressData.gates)
          progressData.gates = { project1: {}, project2: {} };
        const state = progressData.gates[projectId] || {};
        state[gate] = !state[gate];
        progressData.gates[projectId] = state;
        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
        renderGates();
        updateReadinessUI();
        updateRoleFitUI();
        updateCharts();
      }

      function togglePerf(projectId) {
        if (!progressData.gates)
          progressData.gates = { project1: {}, project2: {} };
        const state = progressData.gates[projectId] || {};
        state.perfWin = !state.perfWin;
        progressData.gates[projectId] = state;
        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
        renderGates();
        updateReadinessUI();
        updateRoleFitUI();
      }

      // Express vs NestJS guidance
      function renderExpressNest() {
        const el = document.getElementById("expressNestContent");
        if (!el) return;
        el.innerHTML = `
                <div class="topic">
                    <div class="topic-description">
                        <strong>Recommendation</strong>: Use <em>Express + TypeScript + Prisma</em> for Projects 1‚Äì2 to ship faster. After interviews begin, add an optional <em>NestJS</em> project to showcase DI, guards, pipes, and filters.
                        <ul style="margin-top:.75rem;">
                            <li><strong>Express</strong>: minimal ceremony, fastest iteration, best for shipping artifacts.</li>
                            <li><strong>NestJS</strong>: strong architecture signal (modules/providers/guards) once artifacts exist.</li>
                        </ul>
                    </div>
                </div>`;
      }

      // Resources grid
      function renderResourcesGrid() {
        const grid = document.getElementById("resourcesGrid");
        if (!grid) return;
        // Aggregate per-week resources as curated set
        const items = [];
        (currentRoadmap.learningObjectives || []).forEach((objective) => {
          (objective.topics || []).forEach((topic) => {
            const weekLabel = topic.title || topic.id;
            const pushRes = (r, tag) =>
              items.push({
                name: `${r.name} ‚Äî ${tag}`,
                url: r.url,
                meta: `${
                  typeof r.hours === "number" ? `~${r.hours}h` : ""
                } ¬∑ ${weekLabel}`,
              });
            if (Array.isArray(topic.resources))
              topic.resources.forEach((r) => pushRes(r, "Core"));
            if (Array.isArray(topic.optionalResources))
              topic.optionalResources.forEach((r) => pushRes(r, "Optional"));
          });
        });
        grid.innerHTML = items
          .map(
            (r) => `
              <div class="advanced-topic">
                <div class="advanced-topic-title">üîó <a href="${r.url}" target="_blank" class="resource-link" style="background:none;border:none;padding:0;">${r.name}</a></div>
                <div class="advanced-topic-desc">${r.meta}</div>
              </div>`
          )
          .join("");
      }

      // Export progress
      function exportProgress() {
        const exportData = {
          ...progressData,
          exportDate: new Date().toISOString(),
          version: "2.0",
        };

        const blob = new Blob([JSON.stringify(exportData, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `roadmap-progress-${
          new Date().toISOString().split("T")[0]
        }.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showAchievement("üíæ Progress Exported Successfully!");
      }

      // Import progress
      function importProgress() {
        document.getElementById("fileModal").classList.add("show");
      }

      // Process file import
      function processFileImport() {
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];

        if (!file) {
          alert("Please select a file to import.");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const data = JSON.parse(e.target.result);

            // Validate imported data
            if (!validateImportData(data)) {
              return;
            }

            importData = data;

            // Close file modal but keep importData
            document.getElementById("fileModal").classList.remove("show");
            document.getElementById("fileInput").value = "";

            // Check if user has existing progress
            const hasExistingProgress =
              Object.keys(progressData.tasks).length > 0 ||
              Object.keys(progressData.notes).length > 0 ||
              Object.keys(progressData.timeSpent).length > 0 ||
              Object.keys(progressData.progress).length > 0;

            if (hasExistingProgress) {
              document.getElementById("importModal").classList.add("show");
            } else {
              handleImport("overwrite");
            }
          } catch (error) {
            alert(
              "Error reading file. Please ensure it's a valid JSON file.\n\nError: " +
                error.message
            );
          }
        };
        reader.readAsText(file);
      }

      // Validate import data
      function validateImportData(data) {
        if (!data || typeof data !== "object") {
          return false;
        }

        const requiredFields = ["tasks", "notes", "timeSpent"];
        const missingFields = requiredFields.filter(
          (field) => !data.hasOwnProperty(field)
        );

        if (missingFields.length > 0) {
          alert(`Missing required fields: ${missingFields.join(", ")}`);
          return false;
        }

        // Validate that fields are objects
        if (
          typeof data.tasks !== "object" ||
          typeof data.notes !== "object" ||
          typeof data.timeSpent !== "object"
        ) {
          alert("Invalid field types - all progress fields must be objects");
          return false;
        }

        // Progress field is optional for backward compatibility
        if (data.progress && typeof data.progress !== "object") {
          alert("Invalid progress field type - must be an object");
          return false;
        }

        // Optional new fields
        if (
          data.resourceCompleted &&
          typeof data.resourceCompleted !== "object"
        ) {
          alert("Invalid resourceCompleted field type - must be an object");
          return false;
        }
        if (
          data.resourceProgress &&
          typeof data.resourceProgress !== "object"
        ) {
          alert("Invalid resourceProgress field type - must be an object");
          return false;
        }

        return true;
      }

      // Handle import with user preference
      function handleImport(action) {
        if (!importData) {
          alert(
            "Import failed: No data available. Please try importing again."
          );
          return;
        }

        if (action === "overwrite") {
          progressData = {
            tasks: importData.tasks || {},
            notes: importData.notes || {},
            timeSpent: importData.timeSpent || {},
            progress: importData.progress || {},
            resourceCompleted: importData.resourceCompleted || {},
            resourceProgress: importData.resourceProgress || {},
            problemsSolved: importData.problemsSolved || 0,
            lastUpdated: new Date().toISOString(),
            version: importData.version || "v3"
          };
        } else if (action === "merge") {
          progressData.tasks = { ...progressData.tasks, ...importData.tasks };
          progressData.notes = { ...progressData.notes, ...importData.notes };
          progressData.timeSpent = {
            ...progressData.timeSpent,
            ...importData.timeSpent,
          };
          progressData.progress = {
            ...progressData.progress,
            ...(importData.progress || {}),
          };
          progressData.resourceCompleted = {
            ...(progressData.resourceCompleted || {}),
            ...(importData.resourceCompleted || {}),
          };
          progressData.resourceProgress = {
            ...(progressData.resourceProgress || {}),
            ...(importData.resourceProgress || {}),
          };
          if (typeof importData.problemsSolved === 'number') {
            progressData.problemsSolved = importData.problemsSolved;
          }
          progressData.lastUpdated = new Date().toISOString();
        }

        saveProgressToStorage();
        closeModal();
        showAchievement("üì• Progress Imported Successfully!");
        location.reload();
      }

      // Reset all progress
      function resetProgress() {
        if (
          confirm(
            "üîÑ Are you sure you want to reset your entire quest? This will clear all progress and cannot be undone!"
          )
        ) {
          progressData = {
            tasks: {},
            notes: {},
            timeSpent: {},
            progress: {},
            problemsSolved: 0,
            lastUpdated: null,
            version: "v3"
          };
          saveProgressToStorage();
          showAchievement("üîÑ Quest Reset - Ready for a Fresh Start!");
          location.reload();
        }
      }

      // Close modal
      function closeModal() {
        document.querySelectorAll(".modal").forEach((modal) => {
          modal.classList.remove("show");
        });
        document.getElementById("fileInput").value = "";
        importData = null;
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", init);

      // Add some keyboard shortcuts for power users
      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case "e":
              e.preventDefault();
              exportProgress();
              break;
            case "i":
              e.preventDefault();
              importProgress();
              break;
          }
        }
      });

      function toggleResource(resourceId, topicId) {
        // Accept optional topicId for immediate topic progress recompute
        updateResourceCompletion(resourceId, topicId || null);
      }

      // NEW: Resource progress + completion handling
      function updateResourceCompletion(resourceId, topicId) {
        if (!progressData.resourceCompleted)
          progressData.resourceCompleted = {};
        if (!progressData.resourceProgress) progressData.resourceProgress = {};

        const wasChecked = !!progressData.resourceCompleted[resourceId];
        const checkbox = document.getElementById(`reschk-${resourceId}`);
        const nowChecked = checkbox ? checkbox.checked : !wasChecked;
        progressData.resourceCompleted[resourceId] = nowChecked;

        // If checked => set progress 100. If unchecked: keep last numeric unless it was 100, then reset to 0
        const prev =
          typeof progressData.resourceProgress[resourceId] === "number"
            ? progressData.resourceProgress[resourceId]
            : wasChecked
            ? 100
            : 0;
        if (nowChecked) {
          progressData.resourceProgress[resourceId] = 100;
        } else {
          progressData.resourceProgress[resourceId] = prev === 100 ? 0 : prev;
        }

        // Reflect UI label
        const label = document.getElementById(`resprog-${resourceId}`);
        if (label)
          label.textContent = `${progressData.resourceProgress[resourceId]}%`;

        // Recompute topic progress if we know the topic
        if (topicId) {
          const topic = findTopicById(topicId);
          if (topic) {
            const pct = computeTopicProgressFromResources(topic);
            progressData.progress[topicId] = pct;
            const el = document.getElementById(`topicprog-${topicId}`);
            if (el) el.textContent = `${pct}%`;
          }
        }

        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
        updateStats();
        updateCharts();
        
        if (currentVersion === 'v1') {
            updateReadinessUI();
            updateRoleFitUI();
        }
      }

      function updateResourceProgress(resourceId, topicId, value) {
        if (!progressData.resourceProgress) progressData.resourceProgress = {};
        const val = Math.max(0, Math.min(100, parseInt(value, 10) || 0));
        progressData.resourceProgress[resourceId] = val;

        // If slider hits 100, auto-check; if it drops from 100 and box is checked, keep checked per rule? We only auto-check on 100.
        const chk = document.getElementById(`reschk-${resourceId}`);
        if (chk) {
          if (val >= 100) chk.checked = true;
          // Keep existing check otherwise; do not auto-uncheck on <100
          progressData.resourceCompleted[resourceId] = chk.checked;
        }

        const label = document.getElementById(`resprog-${resourceId}`);
        if (label) label.textContent = `${val}%`;

        // Recompute topic progress
        const topic = findTopicById(topicId);
        if (topic) {
          const pct = computeTopicProgressFromResources(topic);
          progressData.progress[topicId] = pct;
          const el = document.getElementById(`topicprog-${topicId}`);
          if (el) el.textContent = `${pct}%`;
        }

        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
        updateStats();
        updateCharts();
        if (currentVersion === 'v1') {
            updateReadinessUI();
            updateRoleFitUI();
        }
      }

      function computeTopicProgressFromResources(topic) {
        if (!Array.isArray(topic.resources) || topic.resources.length === 0) {
          return Math.max(
            0,
            Math.min(100, progressData.progress[topic.id] || 0)
          );
        }
        const weights = topic.resources.map((r) => {
          const hrs = typeof r.hours === "number" ? r.hours : 1;
          return Math.max(0.5, hrs); // minimum weight to avoid zero
        });
        const ids = topic.resources.map(
          (r) => `${topic.id}-` + btoa(r.url).replace(/=/g, "")
        );
        const progresses = ids.map((rid, i) => {
          const checked =
            progressData.resourceCompleted &&
            progressData.resourceCompleted[rid];
          const val =
            progressData.resourceProgress &&
            typeof progressData.resourceProgress[rid] === "number"
              ? progressData.resourceProgress[rid]
              : checked
              ? 100
              : 0;
          return { val, w: weights[i] };
        });
        // Include optional resources at half-weight
        if (
          Array.isArray(topic.optionalResources) &&
          topic.optionalResources.length
        ) {
          const optIds = topic.optionalResources.map(
            (r) => `${topic.id}-` + btoa(r.url).replace(/=/g, "")
          );
          const optWeights = topic.optionalResources.map((r) => {
            const hrs = typeof r.hours === "number" ? r.hours : 1;
            return Math.max(0.25, hrs * 0.5);
          });
          optIds.forEach((rid, i) => {
            const checked =
              progressData.resourceCompleted &&
              progressData.resourceCompleted[rid];
            const val =
              progressData.resourceProgress &&
              typeof progressData.resourceProgress[rid] === "number"
                ? progressData.resourceProgress[rid]
                : checked
                ? 100
                : 0;
            progresses.push({ val, w: optWeights[i] });
          });
        }
        const sumW = progresses.reduce((a, p) => a + p.w, 0);
        const sum = progresses.reduce((a, p) => a + (p.val / 100) * p.w, 0);
        const pct = sumW > 0 ? Math.round((sum / sumW) * 100) : 0;
        return Math.max(0, Math.min(100, pct));
      }

      function recomputeAllTopicProgressFromResources() {
        currentRoadmap.learningObjectives.forEach((objective) => {
          objective.topics.forEach((topic) => {
            const pct = computeTopicProgressFromResources(topic);
            // Use best estimate policy: resource-driven overrides manual
            progressData.progress[topic.id] = pct;
          });
        });
        progressData.lastUpdated = new Date().toISOString();
        saveProgressToStorage();
      }

      // Job Coverage rendering
      function renderJobCoverage() {
        const container = document.getElementById("jobCoverage");
        if (!container) return;
        const items = [
          {
            id: "coverage-mid",
            title: 'Mid-Level "Feature Owner" (95% Coverage)',
            percent: 95,
            bullets: [
              {
                label: "Strong Node.js/TypeScript/Express (Weeks 1-3, 8-12)",
                weeks: [
                  "w1-express-prisma-docker",
                  "w2-testing-ci",
                  "w3-auth-security",
                  "w8-ship-project-1",
                  "w11-system-design",
                  "w12-interview-prep",
                ],
              },
              { label: "API Development (Week 4)", weeks: ["w4-openapi"] },
              {
                label: "Database Management (Weeks 1, 6, 11)",
                weeks: [
                  "w1-express-prisma-docker",
                  "w6-caching-performance",
                  "w11-system-design",
                ],
              },
              {
                label: "Testing (Weeks 2, 7, 12)",
                weeks: ["w2-testing-ci", "w7-realtime", "w12-interview-prep"],
              },
              { label: "CI/CD + Docker (Week 2)", weeks: ["w2-testing-ci"] },
              {
                label: "Security (Weeks 3, 7)",
                weeks: ["w3-auth-security", "w7-realtime"],
              },
              {
                label: "Ownership (Weeks 8, 12)",
                weeks: ["w8-ship-project-1", "w12-interview-prep"],
              },
              { label: "Collaboration (All weeks)", weeks: [] },
            ],
          },
          {
            id: "coverage-senior",
            title: 'Senior "System Owner" (90% Coverage)',
            percent: 90,
            bullets: [
              {
                label: "All Mid-Level Skills (Weeks 1-12)",
                weeks: [
                  "w1-express-prisma-docker",
                  "w2-testing-ci",
                  "w3-auth-security",
                  "w4-openapi",
                  "w5-payments-workers",
                  "w6-caching-performance",
                  "w7-realtime",
                  "w8-ship-project-1",
                  "w9-ecommerce-part1",
                  "w10-ecommerce-part2",
                  "w11-system-design",
                  "w12-interview-prep",
                ],
              },
              {
                label: "System Design (Week 11)",
                weeks: ["w11-system-design"],
              },
              {
                label:
                  "Advanced Patterns: Idempotency, Concurrency, Caching, Rate Limiting, Database, API, Authorization, Error Handling (Weeks 2-7, 11)",
                weeks: [
                  "w2-testing-ci",
                  "w3-auth-security",
                  "w4-openapi",
                  "w5-payments-workers",
                  "w6-caching-performance",
                  "w7-realtime",
                  "w11-system-design",
                ],
              },
              {
                label: "Database Expertise (Weeks 1, 6, 11)",
                weeks: [
                  "w1-express-prisma-docker",
                  "w6-caching-performance",
                  "w11-system-design",
                ],
              },
              {
                label: "Advanced Security (Week 3)",
                weeks: ["w3-auth-security"],
              },
              { label: "Leadership (Weeks 13+)", weeks: [] },
              { label: "Trade-off Communication (ADRs all weeks)", weeks: [] },
            ],
          },
        ];

        container.innerHTML = items
          .map((group) => {
            const list = group.bullets
              .map((b) => {
                const linkSpan =
                  b.weeks && b.weeks.length
                    ? `<span style="display:flex;gap:.3rem;margin-left:.35rem;flex-wrap:wrap;">${b.weeks
                        .map(
                          (w) =>
                            `<a href="#topic-${w}" class="resource-link" style=\"padding:.15rem .5rem;\">${w
                              .toUpperCase()
                              .slice(0, 2)}</a>`
                        )
                        .join("")}</span>`
                    : "";
                return `<div class=\"coverage-item\" onclick=\"scrollToWeeks('${(
                  b.weeks || []
                ).join(",")}')\">‚úÖ ${b.label}${linkSpan}</div>`;
              })
              .join("");
            return `
              <div class=\"topic\">
                <div class=\"topic-header\">
                  <div class=\"checkbox-container\">
                    <label class=\"topic-title\">${group.title}</label>
                  </div>
                </div>
                <div class=\"coverage-title\">Coverage</div>
                <div class=\"coverage-progress\"><div class=\"coverage-bar\" style=\"width:${group.percent}%\"></div></div>
                <div class=\"notes-container\" style=\"margin-top:1rem;\">
                  <div class=\"coverage-list\">${list}</div>
                </div>
              </div>`;
          })
          .join("");
      }

      function scrollToWeeks(weekIdsCsv) {
        if (!weekIdsCsv) return;
        const ids = weekIdsCsv.split(",").filter(Boolean);
        if (ids.length === 0) return;
        const el = document.getElementById(`topic-${ids[0]}`);
        if (el) {
          el.scrollIntoView({ behavior: "smooth", block: "start" });
          el.classList.add("completed");
          setTimeout(() => el.classList.remove("completed"), 1200);
        }
      }
    </script>
  </body>
</html>
